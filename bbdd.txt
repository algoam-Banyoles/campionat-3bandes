TAULA
[
  {
    "table_name": "admins",
    "column_name": "email",
    "data_type": "text",
    "is_nullable": "NO",
    "key_type": "PRIMARY KEY",
    "constraint_name": "admins_pkey",
    "key_column_name": "email",
    "key_position": 1
  },
  {
    "table_name": "app_settings",
    "column_name": "id",
    "data_type": "uuid",
    "is_nullable": "NO",
    "key_type": "PRIMARY KEY",
    "constraint_name": "app_settings_pkey",
    "key_column_name": "id",
    "key_position": 1
  },
  {
    "table_name": "app_settings",
    "column_name": "caramboles_objectiu",
    "data_type": "smallint",
    "is_nullable": "NO",
    "key_type": "PRIMARY KEY",
    "constraint_name": "app_settings_pkey",
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "app_settings",
    "column_name": "max_entrades",
    "data_type": "smallint",
    "is_nullable": "NO",
    "key_type": "PRIMARY KEY",
    "constraint_name": "app_settings_pkey",
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "app_settings",
    "column_name": "allow_tiebreak",
    "data_type": "boolean",
    "is_nullable": "NO",
    "key_type": "PRIMARY KEY",
    "constraint_name": "app_settings_pkey",
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "app_settings",
    "column_name": "updated_at",
    "data_type": "timestamp with time zone",
    "is_nullable": "NO",
    "key_type": "PRIMARY KEY",
    "constraint_name": "app_settings_pkey",
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "app_settings",
    "column_name": "cooldown_min_dies",
    "data_type": "smallint",
    "is_nullable": "NO",
    "key_type": "PRIMARY KEY",
    "constraint_name": "app_settings_pkey",
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "app_settings",
    "column_name": "cooldown_max_dies",
    "data_type": "smallint",
    "is_nullable": "NO",
    "key_type": "PRIMARY KEY",
    "constraint_name": "app_settings_pkey",
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "app_settings",
    "column_name": "dies_acceptar_repte",
    "data_type": "smallint",
    "is_nullable": "NO",
    "key_type": "PRIMARY KEY",
    "constraint_name": "app_settings_pkey",
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "app_settings",
    "column_name": "dies_jugar_despres_acceptar",
    "data_type": "smallint",
    "is_nullable": "NO",
    "key_type": "PRIMARY KEY",
    "constraint_name": "app_settings_pkey",
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "app_settings",
    "column_name": "ranking_max_jugadors",
    "data_type": "smallint",
    "is_nullable": "NO",
    "key_type": "PRIMARY KEY",
    "constraint_name": "app_settings_pkey",
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "app_settings",
    "column_name": "max_rank_gap",
    "data_type": "smallint",
    "is_nullable": "NO",
    "key_type": "PRIMARY KEY",
    "constraint_name": "app_settings_pkey",
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "app_settings",
    "column_name": "pre_inactiu_setmanes",
    "data_type": "smallint",
    "is_nullable": "NO",
    "key_type": "PRIMARY KEY",
    "constraint_name": "app_settings_pkey",
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "app_settings",
    "column_name": "inactiu_setmanes",
    "data_type": "smallint",
    "is_nullable": "NO",
    "key_type": "PRIMARY KEY",
    "constraint_name": "app_settings_pkey",
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "challenges",
    "column_name": "id",
    "data_type": "uuid",
    "is_nullable": "NO",
    "key_type": "FOREIGN KEY",
    "constraint_name": null,
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "challenges",
    "column_name": "id",
    "data_type": "uuid",
    "is_nullable": "NO",
    "key_type": "PRIMARY KEY",
    "constraint_name": "challenges_pkey",
    "key_column_name": "id",
    "key_position": 1
  },
  {
    "table_name": "challenges",
    "column_name": "id",
    "data_type": "uuid",
    "is_nullable": "NO",
    "key_type": "FOREIGN KEY",
    "constraint_name": null,
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "challenges",
    "column_name": "id",
    "data_type": "uuid",
    "is_nullable": "NO",
    "key_type": "FOREIGN KEY",
    "constraint_name": null,
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "challenges",
    "column_name": "event_id",
    "data_type": "uuid",
    "is_nullable": "NO",
    "key_type": "FOREIGN KEY",
    "constraint_name": null,
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "challenges",
    "column_name": "event_id",
    "data_type": "uuid",
    "is_nullable": "NO",
    "key_type": "PRIMARY KEY",
    "constraint_name": "challenges_pkey",
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "challenges",
    "column_name": "event_id",
    "data_type": "uuid",
    "is_nullable": "NO",
    "key_type": "FOREIGN KEY",
    "constraint_name": null,
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "challenges",
    "column_name": "event_id",
    "data_type": "uuid",
    "is_nullable": "NO",
    "key_type": "FOREIGN KEY",
    "constraint_name": null,
    "key_column_name": "event_id",
    "key_position": 1
  },
  {
    "table_name": "challenges",
    "column_name": "tipus",
    "data_type": "USER-DEFINED",
    "is_nullable": "NO",
    "key_type": "FOREIGN KEY",
    "constraint_name": null,
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "challenges",
    "column_name": "tipus",
    "data_type": "USER-DEFINED",
    "is_nullable": "NO",
    "key_type": "FOREIGN KEY",
    "constraint_name": null,
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "challenges",
    "column_name": "tipus",
    "data_type": "USER-DEFINED",
    "is_nullable": "NO",
    "key_type": "PRIMARY KEY",
    "constraint_name": "challenges_pkey",
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "challenges",
    "column_name": "tipus",
    "data_type": "USER-DEFINED",
    "is_nullable": "NO",
    "key_type": "FOREIGN KEY",
    "constraint_name": null,
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "challenges",
    "column_name": "reptador_id",
    "data_type": "uuid",
    "is_nullable": "NO",
    "key_type": "FOREIGN KEY",
    "constraint_name": null,
    "key_column_name": "reptador_id",
    "key_position": 1
  },
  {
    "table_name": "challenges",
    "column_name": "reptador_id",
    "data_type": "uuid",
    "is_nullable": "NO",
    "key_type": "PRIMARY KEY",
    "constraint_name": "challenges_pkey",
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "challenges",
    "column_name": "reptador_id",
    "data_type": "uuid",
    "is_nullable": "NO",
    "key_type": "FOREIGN KEY",
    "constraint_name": null,
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "challenges",
    "column_name": "reptador_id",
    "data_type": "uuid",
    "is_nullable": "NO",
    "key_type": "FOREIGN KEY",
    "constraint_name": null,
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "challenges",
    "column_name": "reptat_id",
    "data_type": "uuid",
    "is_nullable": "NO",
    "key_type": "PRIMARY KEY",
    "constraint_name": "challenges_pkey",
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "challenges",
    "column_name": "reptat_id",
    "data_type": "uuid",
    "is_nullable": "NO",
    "key_type": "FOREIGN KEY",
    "constraint_name": null,
    "key_column_name": "reptat_id",
    "key_position": 1
  },
  {
    "table_name": "challenges",
    "column_name": "reptat_id",
    "data_type": "uuid",
    "is_nullable": "NO",
    "key_type": "FOREIGN KEY",
    "constraint_name": null,
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "challenges",
    "column_name": "reptat_id",
    "data_type": "uuid",
    "is_nullable": "NO",
    "key_type": "FOREIGN KEY",
    "constraint_name": null,
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "challenges",
    "column_name": "estat",
    "data_type": "USER-DEFINED",
    "is_nullable": "NO",
    "key_type": "FOREIGN KEY",
    "constraint_name": null,
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "challenges",
    "column_name": "estat",
    "data_type": "USER-DEFINED",
    "is_nullable": "NO",
    "key_type": "FOREIGN KEY",
    "constraint_name": null,
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "challenges",
    "column_name": "estat",
    "data_type": "USER-DEFINED",
    "is_nullable": "NO",
    "key_type": "FOREIGN KEY",
    "constraint_name": null,
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "challenges",
    "column_name": "estat",
    "data_type": "USER-DEFINED",
    "is_nullable": "NO",
    "key_type": "PRIMARY KEY",
    "constraint_name": "challenges_pkey",
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "challenges",
    "column_name": "dates_proposades",
    "data_type": "ARRAY",
    "is_nullable": "NO",
    "key_type": "FOREIGN KEY",
    "constraint_name": null,
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "challenges",
    "column_name": "dates_proposades",
    "data_type": "ARRAY",
    "is_nullable": "NO",
    "key_type": "FOREIGN KEY",
    "constraint_name": null,
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "challenges",
    "column_name": "dates_proposades",
    "data_type": "ARRAY",
    "is_nullable": "NO",
    "key_type": "PRIMARY KEY",
    "constraint_name": "challenges_pkey",
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "challenges",
    "column_name": "dates_proposades",
    "data_type": "ARRAY",
    "is_nullable": "NO",
    "key_type": "FOREIGN KEY",
    "constraint_name": null,
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "challenges",
    "column_name": "data_proposta",
    "data_type": "timestamp with time zone",
    "is_nullable": "NO",
    "key_type": "FOREIGN KEY",
    "constraint_name": null,
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "challenges",
    "column_name": "data_proposta",
    "data_type": "timestamp with time zone",
    "is_nullable": "NO",
    "key_type": "FOREIGN KEY",
    "constraint_name": null,
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "challenges",
    "column_name": "data_proposta",
    "data_type": "timestamp with time zone",
    "is_nullable": "NO",
    "key_type": "FOREIGN KEY",
    "constraint_name": null,
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "challenges",
    "column_name": "data_proposta",
    "data_type": "timestamp with time zone",
    "is_nullable": "NO",
    "key_type": "PRIMARY KEY",
    "constraint_name": "challenges_pkey",
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "challenges",
    "column_name": "data_acceptacio",
    "data_type": "timestamp with time zone",
    "is_nullable": "YES",
    "key_type": "FOREIGN KEY",
    "constraint_name": null,
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "challenges",
    "column_name": "data_acceptacio",
    "data_type": "timestamp with time zone",
    "is_nullable": "YES",
    "key_type": "FOREIGN KEY",
    "constraint_name": null,
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "challenges",
    "column_name": "data_acceptacio",
    "data_type": "timestamp with time zone",
    "is_nullable": "YES",
    "key_type": "PRIMARY KEY",
    "constraint_name": "challenges_pkey",
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "challenges",
    "column_name": "data_acceptacio",
    "data_type": "timestamp with time zone",
    "is_nullable": "YES",
    "key_type": "FOREIGN KEY",
    "constraint_name": null,
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "challenges",
    "column_name": "observacions",
    "data_type": "text",
    "is_nullable": "YES",
    "key_type": "FOREIGN KEY",
    "constraint_name": null,
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "challenges",
    "column_name": "observacions",
    "data_type": "text",
    "is_nullable": "YES",
    "key_type": "FOREIGN KEY",
    "constraint_name": null,
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "challenges",
    "column_name": "observacions",
    "data_type": "text",
    "is_nullable": "YES",
    "key_type": "FOREIGN KEY",
    "constraint_name": null,
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "challenges",
    "column_name": "observacions",
    "data_type": "text",
    "is_nullable": "YES",
    "key_type": "PRIMARY KEY",
    "constraint_name": "challenges_pkey",
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "challenges",
    "column_name": "pos_reptador",
    "data_type": "smallint",
    "is_nullable": "YES",
    "key_type": "FOREIGN KEY",
    "constraint_name": null,
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "challenges",
    "column_name": "pos_reptador",
    "data_type": "smallint",
    "is_nullable": "YES",
    "key_type": "FOREIGN KEY",
    "constraint_name": null,
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "challenges",
    "column_name": "pos_reptador",
    "data_type": "smallint",
    "is_nullable": "YES",
    "key_type": "PRIMARY KEY",
    "constraint_name": "challenges_pkey",
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "challenges",
    "column_name": "pos_reptador",
    "data_type": "smallint",
    "is_nullable": "YES",
    "key_type": "FOREIGN KEY",
    "constraint_name": null,
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "challenges",
    "column_name": "pos_reptat",
    "data_type": "smallint",
    "is_nullable": "YES",
    "key_type": "FOREIGN KEY",
    "constraint_name": null,
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "challenges",
    "column_name": "pos_reptat",
    "data_type": "smallint",
    "is_nullable": "YES",
    "key_type": "PRIMARY KEY",
    "constraint_name": "challenges_pkey",
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "challenges",
    "column_name": "pos_reptat",
    "data_type": "smallint",
    "is_nullable": "YES",
    "key_type": "FOREIGN KEY",
    "constraint_name": null,
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "challenges",
    "column_name": "pos_reptat",
    "data_type": "smallint",
    "is_nullable": "YES",
    "key_type": "FOREIGN KEY",
    "constraint_name": null,
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "challenges",
    "column_name": "reprogram_count",
    "data_type": "smallint",
    "is_nullable": "NO",
    "key_type": "FOREIGN KEY",
    "constraint_name": null,
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "challenges",
    "column_name": "reprogram_count",
    "data_type": "smallint",
    "is_nullable": "NO",
    "key_type": "PRIMARY KEY",
    "constraint_name": "challenges_pkey",
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "challenges",
    "column_name": "reprogram_count",
    "data_type": "smallint",
    "is_nullable": "NO",
    "key_type": "FOREIGN KEY",
    "constraint_name": null,
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "challenges",
    "column_name": "reprogram_count",
    "data_type": "smallint",
    "is_nullable": "NO",
    "key_type": "FOREIGN KEY",
    "constraint_name": null,
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "challenges",
    "column_name": "data_programada",
    "data_type": "timestamp with time zone",
    "is_nullable": "YES",
    "key_type": "FOREIGN KEY",
    "constraint_name": null,
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "challenges",
    "column_name": "data_programada",
    "data_type": "timestamp with time zone",
    "is_nullable": "YES",
    "key_type": "FOREIGN KEY",
    "constraint_name": null,
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "challenges",
    "column_name": "data_programada",
    "data_type": "timestamp with time zone",
    "is_nullable": "YES",
    "key_type": "PRIMARY KEY",
    "constraint_name": "challenges_pkey",
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "challenges",
    "column_name": "data_programada",
    "data_type": "timestamp with time zone",
    "is_nullable": "YES",
    "key_type": "FOREIGN KEY",
    "constraint_name": null,
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "challenges",
    "column_name": "reprogramacions",
    "data_type": "integer",
    "is_nullable": "NO",
    "key_type": "FOREIGN KEY",
    "constraint_name": null,
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "challenges",
    "column_name": "reprogramacions",
    "data_type": "integer",
    "is_nullable": "NO",
    "key_type": "PRIMARY KEY",
    "constraint_name": "challenges_pkey",
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "challenges",
    "column_name": "reprogramacions",
    "data_type": "integer",
    "is_nullable": "NO",
    "key_type": "FOREIGN KEY",
    "constraint_name": null,
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "challenges",
    "column_name": "reprogramacions",
    "data_type": "integer",
    "is_nullable": "NO",
    "key_type": "FOREIGN KEY",
    "constraint_name": null,
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "events",
    "column_name": "id",
    "data_type": "uuid",
    "is_nullable": "NO",
    "key_type": "PRIMARY KEY",
    "constraint_name": "events_pkey",
    "key_column_name": "id",
    "key_position": 1
  },
  {
    "table_name": "events",
    "column_name": "nom",
    "data_type": "text",
    "is_nullable": "NO",
    "key_type": "PRIMARY KEY",
    "constraint_name": "events_pkey",
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "events",
    "column_name": "temporada",
    "data_type": "text",
    "is_nullable": "NO",
    "key_type": "PRIMARY KEY",
    "constraint_name": "events_pkey",
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "events",
    "column_name": "creat_el",
    "data_type": "timestamp with time zone",
    "is_nullable": "NO",
    "key_type": "PRIMARY KEY",
    "constraint_name": "events_pkey",
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "events",
    "column_name": "actiu",
    "data_type": "boolean",
    "is_nullable": "NO",
    "key_type": "PRIMARY KEY",
    "constraint_name": "events_pkey",
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "history_position_changes",
    "column_name": "id",
    "data_type": "uuid",
    "is_nullable": "NO",
    "key_type": "PRIMARY KEY",
    "constraint_name": "history_position_changes_pkey",
    "key_column_name": "id",
    "key_position": 1
  },
  {
    "table_name": "history_position_changes",
    "column_name": "id",
    "data_type": "uuid",
    "is_nullable": "NO",
    "key_type": "FOREIGN KEY",
    "constraint_name": null,
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "history_position_changes",
    "column_name": "id",
    "data_type": "uuid",
    "is_nullable": "NO",
    "key_type": "FOREIGN KEY",
    "constraint_name": null,
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "history_position_changes",
    "column_name": "id",
    "data_type": "uuid",
    "is_nullable": "NO",
    "key_type": "FOREIGN KEY",
    "constraint_name": null,
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "history_position_changes",
    "column_name": "event_id",
    "data_type": "uuid",
    "is_nullable": "NO",
    "key_type": "PRIMARY KEY",
    "constraint_name": "history_position_changes_pkey",
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "history_position_changes",
    "column_name": "event_id",
    "data_type": "uuid",
    "is_nullable": "NO",
    "key_type": "FOREIGN KEY",
    "constraint_name": null,
    "key_column_name": "event_id",
    "key_position": 1
  },
  {
    "table_name": "history_position_changes",
    "column_name": "event_id",
    "data_type": "uuid",
    "is_nullable": "NO",
    "key_type": "FOREIGN KEY",
    "constraint_name": null,
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "history_position_changes",
    "column_name": "event_id",
    "data_type": "uuid",
    "is_nullable": "NO",
    "key_type": "FOREIGN KEY",
    "constraint_name": null,
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "history_position_changes",
    "column_name": "player_id",
    "data_type": "uuid",
    "is_nullable": "NO",
    "key_type": "PRIMARY KEY",
    "constraint_name": "history_position_changes_pkey",
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "history_position_changes",
    "column_name": "player_id",
    "data_type": "uuid",
    "is_nullable": "NO",
    "key_type": "FOREIGN KEY",
    "constraint_name": null,
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "history_position_changes",
    "column_name": "player_id",
    "data_type": "uuid",
    "is_nullable": "NO",
    "key_type": "FOREIGN KEY",
    "constraint_name": null,
    "key_column_name": "player_id",
    "key_position": 1
  },
  {
    "table_name": "history_position_changes",
    "column_name": "player_id",
    "data_type": "uuid",
    "is_nullable": "NO",
    "key_type": "FOREIGN KEY",
    "constraint_name": null,
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "history_position_changes",
    "column_name": "posicio_anterior",
    "data_type": "smallint",
    "is_nullable": "NO",
    "key_type": "FOREIGN KEY",
    "constraint_name": null,
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "history_position_changes",
    "column_name": "posicio_anterior",
    "data_type": "smallint",
    "is_nullable": "NO",
    "key_type": "PRIMARY KEY",
    "constraint_name": "history_position_changes_pkey",
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "history_position_changes",
    "column_name": "posicio_anterior",
    "data_type": "smallint",
    "is_nullable": "NO",
    "key_type": "FOREIGN KEY",
    "constraint_name": null,
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "history_position_changes",
    "column_name": "posicio_anterior",
    "data_type": "smallint",
    "is_nullable": "NO",
    "key_type": "FOREIGN KEY",
    "constraint_name": null,
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "history_position_changes",
    "column_name": "posicio_nova",
    "data_type": "smallint",
    "is_nullable": "NO",
    "key_type": "PRIMARY KEY",
    "constraint_name": "history_position_changes_pkey",
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "history_position_changes",
    "column_name": "posicio_nova",
    "data_type": "smallint",
    "is_nullable": "NO",
    "key_type": "FOREIGN KEY",
    "constraint_name": null,
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "history_position_changes",
    "column_name": "posicio_nova",
    "data_type": "smallint",
    "is_nullable": "NO",
    "key_type": "FOREIGN KEY",
    "constraint_name": null,
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "history_position_changes",
    "column_name": "posicio_nova",
    "data_type": "smallint",
    "is_nullable": "NO",
    "key_type": "FOREIGN KEY",
    "constraint_name": null,
    "key_column_name": null,
    "key_position": null
  },
  {
    "table_name": "history_position_changes",
    "column_name": "motiu",
    "data_type": "text",
    "is_nullable": "NO",
    "key_type": "FOREIGN KEY",
    "constraint_name": null,
    "key_column_name": null,
    "key_position": null
  }
]

FUNCIONS
[
  {
    "function_name": "_admins_email_lowercase",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public._admins_email_lowercase()\n RETURNS trigger\n LANGUAGE plpgsql\nAS $function$\r\nbegin\r\n  new.email := lower(new.email);\r\n  return new;\r\nend$function$\n",
    "arguments": "",
    "return_type": "trigger",
    "volatility": "VOLATILE",
    "security_definer": false,
    "is_strict": false,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "_app_settings_set_updated_at",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public._app_settings_set_updated_at()\n RETURNS trigger\n LANGUAGE plpgsql\nAS $function$\r\nbegin\r\n  new.updated_at := now();\r\n  return new;\r\nend; $function$\n",
    "arguments": "",
    "return_type": "trigger",
    "volatility": "VOLATILE",
    "security_definer": false,
    "is_strict": false,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "_set_search_path",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public._set_search_path()\n RETURNS void\n LANGUAGE sql\nAS $function$\r\n  select set_config('search_path','public', true);\r\n$function$\n",
    "arguments": "",
    "return_type": "void",
    "volatility": "VOLATILE",
    "security_definer": false,
    "is_strict": false,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "accept_challenge",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.accept_challenge(_id uuid, _data timestamp with time zone)\n RETURNS void\n LANGUAGE plpgsql\n SECURITY DEFINER\nAS $function$\r\ndeclare\r\n  dies_accept smallint; dt_proposta timestamptz;\r\nbegin\r\n  select dies_acceptar_repte into dies_accept from public.app_settings limit 1;\r\n  select data_proposta into dt_proposta from public.challenges where id=_id;\r\n\r\n  if now() > dt_proposta + make_interval(days => dies_accept) then\r\n    update public.challenges set estat='expirat' where id=_id;\r\n    raise exception 'Repte expirat per falta d’acceptació';\r\n  end if;\r\n\r\n  update public.challenges\r\n     set estat='acceptat', data_acceptacio=now(),\r\n         data_programada = coalesce(_data, data_programada)\r\n   where id=_id and estat='proposat';\r\n  if not found then raise exception 'Només es pot acceptar un repte proposat';\r\n  end if;\r\nend$function$\n",
    "arguments": "_id uuid, _data timestamp with time zone",
    "return_type": "void",
    "volatility": "VOLATILE",
    "security_definer": true,
    "is_strict": false,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "admin_apply_disagreement",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.admin_apply_disagreement(p_event uuid, p_player_a uuid, p_player_b uuid)\n RETURNS void\n LANGUAGE plpgsql\n SECURITY DEFINER\n SET search_path TO 'public'\nAS $function$\r\nbegin\r\n  -- Revalidació interna si voleu (es pot mantenir per auditar correu)\r\n  perform is_admin_by_email();\r\n  if not found then\r\n    raise exception 'No ets admin';\r\n  end if;\r\n\r\n  perform apply_disagreement_drop(p_event, p_player_a, p_player_b);\r\nend$function$\n",
    "arguments": "p_event uuid, p_player_a uuid, p_player_b uuid",
    "return_type": "void",
    "volatility": "VOLATILE",
    "security_definer": true,
    "is_strict": false,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "admin_apply_no_show",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.admin_apply_no_show(p_challenge uuid, p_no_show_player uuid)\n RETURNS void\n LANGUAGE plpgsql\n SECURITY DEFINER\nAS $function$\r\nbegin\r\n  if not public.is_admin_by_email() then\r\n    raise exception 'No ets admin';\r\n  end if;\r\n\r\n  perform public.apply_no_show_win(p_challenge, p_no_show_player);\r\nend\r\n$function$\n",
    "arguments": "p_challenge uuid, p_no_show_player uuid",
    "return_type": "void",
    "volatility": "VOLATILE",
    "security_definer": true,
    "is_strict": false,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "admin_run_all_sweeps",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.admin_run_all_sweeps()\n RETURNS TABLE(kind text, payload jsonb)\n LANGUAGE plpgsql\nAS $function$\r\nbegin\r\n  -- Sweep de reptes fora de termini (llegeix app_settings)\r\n  return query\r\n  select 'challenges_overdue'::text,\r\n         coalesce(json_agg(row_to_json(t)), '[]'::json)::jsonb\r\n  from public.sweep_overdue_challenges_from_settings_mvp2() as t;\r\n\r\n  -- Sweep d’inactivitat\r\n  return query\r\n  select 'inactivity'::text,\r\n         coalesce(json_agg(row_to_json(t)), '[]'::json)::jsonb\r\n  from public.sweep_inactivity_from_settings() as t;\r\nend;\r\n$function$\n",
    "arguments": "",
    "return_type": "record",
    "volatility": "VOLATILE",
    "security_definer": false,
    "is_strict": false,
    "returns_set": true,
    "is_leakproof": false
  },
  {
    "function_name": "admin_run_maintenance",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.admin_run_maintenance()\n RETURNS TABLE(kind text, payload jsonb)\n LANGUAGE plpgsql\n SECURITY DEFINER\nAS $function$\r\nbegin\r\n  -- Sweeps de reptes (terminis)\r\n  return query\r\n  select 'challenges_overdue',\r\n         coalesce(json_agg(row_to_json(t)), '[]'::json)::jsonb\r\n  from public.sweep_overdue_challenges_from_settings_mvp2() as t;\r\n\r\n  -- Sweep d’inactivitat\r\n  return query\r\n  select 'inactivity',\r\n         coalesce(json_agg(row_to_json(t)), '[]'::json)::jsonb\r\n  from public.sweep_inactivity_from_settings() as t;\r\nend;\r\n$function$\n",
    "arguments": "",
    "return_type": "record",
    "volatility": "VOLATILE",
    "security_definer": true,
    "is_strict": false,
    "returns_set": true,
    "is_leakproof": false
  },
  {
    "function_name": "admin_run_maintenance_and_log",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.admin_run_maintenance_and_log(p_triggered_by text DEFAULT 'auto'::text)\n RETURNS TABLE(kind text, payload jsonb)\n LANGUAGE plpgsql\n SECURITY DEFINER\nAS $function$\r\ndeclare\r\n  v_run_id uuid;\r\n  v_any_rows boolean := false;\r\n  r record;\r\nbegin\r\n  -- Obrir capçalera de l'execució\r\n  insert into public.maintenance_runs(triggered_by)\r\n  values (coalesce(p_triggered_by,'auto'))\r\n  returning id into v_run_id;\r\n\r\n  -- Executar el manteniment existent i desar cada bloc de resultats\r\n  for r in\r\n    select * from public.admin_run_maintenance()\r\n  loop\r\n    v_any_rows := true;\r\n\r\n    insert into public.maintenance_run_items(run_id, kind, payload)\r\n    values (v_run_id, r.kind, r.payload);\r\n\r\n    -- Tornar també el resultat cap a fora\r\n    kind := r.kind;\r\n    payload := r.payload;\r\n    return next;\r\n  end loop;\r\n\r\n  -- Tancar capçalera amb èxit\r\n  update public.maintenance_runs\r\n     set finished_at = now(),\r\n         ok = true,\r\n         notes = case when v_any_rows then null else 'Sense canvis' end\r\n   where id = v_run_id;\r\n\r\nexception when others then\r\n  -- Registrar error i propagar-lo\r\n  update public.maintenance_runs\r\n     set finished_at = now(),\r\n         ok = false,\r\n         notes = coalesce(notes,'') || case when coalesce(notes,'')<>'' then E'\\n' end\r\n                 || 'ERROR: ' || sqlstate || ' - ' || sqlerrm\r\n   where id = v_run_id;\r\n  raise;\r\nend;\r\n$function$\n",
    "arguments": "p_triggered_by text DEFAULT 'auto'::text",
    "return_type": "record",
    "volatility": "VOLATILE",
    "security_definer": true,
    "is_strict": false,
    "returns_set": true,
    "is_leakproof": false
  },
  {
    "function_name": "admin_update_challenge_state",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.admin_update_challenge_state(p_challenge uuid, p_new_state challenge_state)\n RETURNS void\n LANGUAGE plpgsql\n SECURITY DEFINER\nAS $function$\r\nbegin\r\n  if not public.is_admin_by_email() then\r\n    raise exception 'No ets admin';\r\n  end if;\r\n\r\n  if p_new_state not in ('acceptat','refusat','anullat','caducat') then\r\n    raise exception 'Estat no permès per admin_update_challenge_state';\r\n  end if;\r\n\r\n  update public.challenges\r\n  set estat = p_new_state\r\n  where id = p_challenge;\r\nend\r\n$function$\n",
    "arguments": "p_challenge uuid, p_new_state challenge_state",
    "return_type": "void",
    "volatility": "VOLATILE",
    "security_definer": true,
    "is_strict": false,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "admin_update_settings",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.admin_update_settings(p_dies_acceptar smallint, p_dies_jugar smallint, p_pre_inact smallint, p_inact smallint)\n RETURNS void\n LANGUAGE sql\n SECURITY DEFINER\nAS $function$\r\n  update public.app_settings\r\n     set dies_acceptar_repte         = p_dies_acceptar,\r\n         dies_jugar_despres_acceptar = p_dies_jugar,\r\n         pre_inactiu_setmanes        = p_pre_inact,\r\n         inactiu_setmanes            = p_inact,\r\n         updated_at                  = now()\r\n   where id = (\r\n     select id from public.app_settings\r\n     order by updated_at desc\r\n     limit 1\r\n   );\r\n$function$\n",
    "arguments": "p_dies_acceptar smallint, p_dies_jugar smallint, p_pre_inact smallint, p_inact smallint",
    "return_type": "void",
    "volatility": "VOLATILE",
    "security_definer": true,
    "is_strict": false,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "apply_challenge_penalty",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.apply_challenge_penalty(p_challenge uuid, p_tipus text)\n RETURNS json\n LANGUAGE plpgsql\n SECURITY DEFINER\n SET search_path TO 'public'\nAS $function$\r\nDECLARE\r\n  v_event   uuid;\r\n  v_reptador uuid;\r\n  v_reptat  uuid;\r\n  v_pos_r   INTEGER;\r\n  v_pos_t   INTEGER;\r\n  v_swap    uuid;\r\n  v_next    uuid;\r\n  v_pos     INTEGER;\r\nBEGIN\r\n  SELECT event_id, reptador_id, reptat_id, pos_reptador, pos_reptat\r\n    INTO v_event, v_reptador, v_reptat, v_pos_r, v_pos_t\r\n    FROM challenges\r\n   WHERE id = p_challenge;\r\n\r\n  IF v_event IS NULL THEN\r\n    RETURN json_build_object('ok', FALSE, 'error', 'challenge_not_found');\r\n  END IF;\r\n\r\n  IF p_tipus = 'incompareixenca' THEN\r\n    UPDATE challenges SET estat = 'refusat' WHERE id = p_challenge;\r\n\r\n    INSERT INTO penalties(event_id, challenge_id, player_id, tipus)\r\n    VALUES (v_event, p_challenge, v_reptat, p_tipus);\r\n\r\n    IF v_pos_r IS NOT NULL\r\n       AND v_pos_t IS NOT NULL\r\n       AND v_pos_r <> v_pos_t THEN\r\n      UPDATE ranking_positions\r\n         SET posicio = CASE\r\n            WHEN player_id = v_reptador THEN v_pos_t\r\n            WHEN player_id = v_reptat   THEN v_pos_r\r\n            ELSE posicio\r\n         END\r\n       WHERE event_id = v_event\r\n         AND player_id IN (v_reptador, v_reptat);\r\n\r\n      INSERT INTO history_position_changes(\r\n        event_id, player_id, posicio_anterior, posicio_nova,\r\n        motiu, ref_challenge\r\n      )\r\n      VALUES\r\n        (v_event, v_reptador, v_pos_r, v_pos_t,\r\n         'victoria per incompareixença', p_challenge),\r\n        (v_event, v_reptat,   v_pos_t, v_pos_r,\r\n         'derrota per incompareixença', p_challenge);\r\n    END IF;\r\n\r\n    RETURN json_build_object('ok', TRUE);\r\n\r\n  ELSIF p_tipus = 'desacord_dates' THEN\r\n    FOR v_swap IN\r\n      SELECT player_id\r\n        FROM ranking_positions\r\n       WHERE event_id = v_event\r\n         AND player_id IN (v_reptador, v_reptat)\r\n       ORDER BY posicio\r\n    LOOP\r\n      SELECT posicio INTO v_pos\r\n        FROM ranking_positions\r\n       WHERE event_id = v_event AND player_id = v_swap;\r\n\r\n      SELECT player_id INTO v_next\r\n        FROM ranking_positions\r\n       WHERE event_id = v_event AND posicio = v_pos + 1;\r\n\r\n      IF v_next IS NOT NULL THEN\r\n        UPDATE ranking_positions\r\n           SET posicio = v_pos + 1\r\n         WHERE event_id = v_event AND player_id = v_swap;\r\n\r\n        UPDATE ranking_positions\r\n           SET posicio = v_pos\r\n         WHERE event_id = v_event AND player_id = v_next;\r\n\r\n        INSERT INTO history_position_changes(\r\n          event_id, player_id, posicio_anterior, posicio_nova,\r\n          motiu, ref_challenge\r\n        )\r\n        VALUES\r\n          (v_event, v_swap, v_pos, v_pos + 1,\r\n           'penalització desacord dates', p_challenge),\r\n          (v_event, v_next, v_pos + 1, v_pos,\r\n           'puja per penalització', p_challenge);\r\n      END IF;\r\n\r\n      INSERT INTO penalties(event_id, challenge_id, player_id, tipus)\r\n      VALUES (v_event, p_challenge, v_swap, p_tipus);\r\n    END LOOP;\r\n\r\n    UPDATE challenges SET estat = 'anullat' WHERE id = p_challenge;\r\n    RETURN json_build_object('ok', TRUE);\r\n\r\n  ELSE\r\n    RETURN json_build_object('ok', FALSE, 'error', 'tipus_not_supported');\r\n  END IF;\r\nEND;\r\n$function$\n",
    "arguments": "p_challenge uuid, p_tipus text",
    "return_type": "json",
    "volatility": "VOLATILE",
    "security_definer": true,
    "is_strict": false,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "apply_disagreement_drop",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.apply_disagreement_drop(p_event uuid, p_player_a uuid, p_player_b uuid)\n RETURNS void\n LANGUAGE plpgsql\n SECURITY DEFINER\n SET search_path TO 'public'\nAS $function$\r\ndeclare\r\n  pos_a int;\r\n  pos_b int;\r\n  min_pos int;\r\n  max_pos int;\r\n  next_exists boolean;\r\nbegin\r\n  -- Posicions actuals dins l'event\r\n  select posicio into pos_a from ranking_positions\r\n   where event_id = p_event and player_id = p_player_a;\r\n  select posicio into pos_b from ranking_positions\r\n   where event_id = p_event and player_id = p_player_b;\r\n\r\n  if pos_a is null or pos_b is null then\r\n    raise exception 'Cal que ambdós estiguin al rànquing per aplicar la penalització';\r\n  end if;\r\n\r\n  min_pos := least(pos_a, pos_b);\r\n  max_pos := greatest(pos_a, pos_b);\r\n\r\n  -- Ha d'existir algú just darrere del pitjor classificat\r\n  select exists (\r\n    select 1 from ranking_positions\r\n    where event_id = p_event and posicio = max_pos + 1\r\n  ) into next_exists;\r\n\r\n  if not next_exists then\r\n    raise exception 'No es pot aplicar la penalització: no hi ha cap jugador darrere de la posició %.', max_pos;\r\n  end if;\r\n\r\n  -- Diferim claus per evitar col·lisions transitòries (el CHECK segueix actiu)\r\n  set constraints ranking_positions_pkey deferred;\r\n  set constraints ranking_positions_event_player_uk deferred;\r\n\r\n  -- Recol·locació en una sola passada i sempre dins del rang 1..N:\r\n  --  - el \"següent\" (max+1) puja a min_pos\r\n  --  - el tram [min..max] baixa 1 posició\r\n  with affected as (\r\n    select event_id,\r\n           posicio,\r\n           case\r\n             when posicio = max_pos + 1 then min_pos\r\n             when posicio between min_pos and max_pos then posicio + 1\r\n             else posicio\r\n           end as new_pos\r\n    from ranking_positions\r\n    where event_id = p_event\r\n      and (posicio between min_pos and max_pos or posicio = max_pos + 1)\r\n  )\r\n  update ranking_positions rp\r\n     set posicio     = a.new_pos,\r\n         assignat_el = now()\r\n    from affected a\r\n   where rp.event_id = a.event_id\r\n     and rp.posicio  = a.posicio;\r\n\r\n  -- Log (si existeix la taula)\r\n  if exists (select 1 from information_schema.tables\r\n             where table_schema='public' and table_name='penalties') then\r\n    insert into penalties(event_id, player_id, tipus, detalls)\r\n    values\r\n      (p_event, p_player_a, 'desacord_dates', 'Pèrdua d’una posició per desacord en dates'),\r\n      (p_event, p_player_b, 'desacord_dates', 'Pèrdua d’una posició per desacord en dates');\r\n  end if;\r\nend$function$\n",
    "arguments": "p_event uuid, p_player_a uuid, p_player_b uuid",
    "return_type": "void",
    "volatility": "VOLATILE",
    "security_definer": true,
    "is_strict": false,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "apply_inactivity",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.apply_inactivity(p_event uuid)\n RETURNS void\n LANGUAGE plpgsql\n SECURITY DEFINER\n SET search_path TO 'public'\nAS $function$\r\nDECLARE\r\n  r RECORD;\r\n  b RECORD;\r\n  v_pos INTEGER;\r\n  v_wait uuid;\r\nBEGIN\r\n  FOR r IN (\r\n    SELECT rp.player_id\r\n      FROM ranking_positions rp\r\n     WHERE rp.event_id = p_event\r\n       AND NOT EXISTS (\r\n         SELECT 1\r\n           FROM challenges c\r\n      LEFT JOIN matches m ON m.challenge_id = c.id\r\n          WHERE c.event_id = p_event\r\n            AND (c.reptador_id = rp.player_id OR c.reptat_id = rp.player_id)\r\n            AND COALESCE(m.data_joc, c.data_proposta)\r\n                >= NOW() - INTERVAL '42 days'\r\n       )\r\n     ORDER BY rp.posicio\r\n  ) LOOP\r\n    SELECT posicio INTO v_pos\r\n      FROM ranking_positions\r\n     WHERE event_id = p_event AND player_id = r.player_id;\r\n\r\n    IF v_pos IS NULL THEN\r\n      CONTINUE;\r\n    END IF;\r\n\r\n    UPDATE players SET estat = 'inactiu' WHERE id = r.player_id;\r\n\r\n    DELETE FROM ranking_positions\r\n      WHERE event_id = p_event AND player_id = r.player_id;\r\n\r\n    INSERT INTO history_position_changes(\r\n      event_id, player_id, posicio_anterior, posicio_nova,\r\n      motiu, ref_challenge\r\n    )\r\n    VALUES (\r\n      p_event,\r\n      r.player_id,\r\n      v_pos,\r\n      NULL,\r\n      'inactivitat',\r\n      NULL\r\n    );\r\n\r\n    -- Puja la resta de jugadors\r\n    FOR b IN (\r\n      SELECT player_id, posicio\r\n        FROM ranking_positions\r\n       WHERE event_id = p_event AND posicio > v_pos\r\n       ORDER BY posicio\r\n    ) LOOP\r\n      UPDATE ranking_positions\r\n         SET posicio = b.posicio - 1\r\n       WHERE event_id = p_event AND player_id = b.player_id;\r\n\r\n      INSERT INTO history_position_changes(\r\n        event_id, player_id, posicio_anterior, posicio_nova,\r\n        motiu, ref_challenge\r\n      )\r\n      VALUES (\r\n        p_event,\r\n        b.player_id,\r\n        b.posicio,\r\n        b.posicio - 1,\r\n        'puja per inactivitat',\r\n        NULL\r\n      );\r\n    END LOOP;\r\n\r\n    SELECT player_id INTO v_wait\r\n      FROM waiting_list\r\n     WHERE event_id = p_event\r\n     ORDER BY ordre ASC\r\n     LIMIT 1;\r\n\r\n    IF v_wait IS NOT NULL THEN\r\n      INSERT INTO ranking_positions(event_id, player_id, posicio)\r\n      VALUES (p_event, v_wait, 20);\r\n\r\n      DELETE FROM waiting_list\r\n        WHERE event_id = p_event AND player_id = v_wait;\r\n\r\n      INSERT INTO history_position_changes(\r\n        event_id, player_id, posicio_anterior, posicio_nova,\r\n        motiu, ref_challenge\r\n      )\r\n      VALUES (\r\n        p_event,\r\n        v_wait,\r\n        NULL,\r\n        20,\r\n        'entra per inactivitat',\r\n        NULL\r\n      );\r\n    END IF;\r\n  END LOOP;\r\nEND;\r\n$function$\n",
    "arguments": "p_event uuid",
    "return_type": "void",
    "volatility": "VOLATILE",
    "security_definer": true,
    "is_strict": false,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "apply_inactivity",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.apply_inactivity(p_player_id uuid, p_event_id uuid)\n RETURNS TABLE(ok boolean, reason text)\n LANGUAGE plpgsql\nAS $function$\r\ndeclare\r\n  v_pos smallint;\r\n  v_first_waiting uuid;\r\nbegin\r\n  select posicio into v_pos\r\n  from public.ranking_positions\r\n  where event_id = p_event_id and player_id = p_player_id;\r\n\r\n  if v_pos is null then\r\n    ok := false; reason := 'jugador no trobat al rànquing'; return next; return;\r\n  end if;\r\n\r\n  -- elimina del rànquing\r\n  delete from public.ranking_positions\r\n   where event_id = p_event_id and player_id = p_player_id;\r\n\r\n  -- baixa a waiting list al final\r\n  insert into public.waiting_list (player_id, ordre, event_id, data_inscripcio)\r\n  values (p_player_id,\r\n          (select coalesce(max(ordre),0)+1 from public.waiting_list),\r\n          p_event_id,\r\n          now());\r\n\r\n  -- promou el primer de la waiting list\r\n  select player_id into v_first_waiting\r\n  from public.waiting_list\r\n  where event_id = p_event_id\r\n  order by ordre asc\r\n  limit 1;\r\n\r\n  if v_first_waiting is not null then\r\n    -- assigna'l a la posició més baixa del rànquing (20)\r\n    insert into public.ranking_positions (event_id, posicio, player_id, assignat_el)\r\n    values (p_event_id, 20, v_first_waiting, now());\r\n\r\n    -- i treu-lo de la waiting list\r\n    delete from public.waiting_list\r\n     where event_id = p_event_id and player_id = v_first_waiting;\r\n\r\n    insert into public.history_position_changes\r\n      (event_id, player_id, posicio_anterior, posicio_nova, motiu, ref_challenge)\r\n    values\r\n      (p_event_id, v_first_waiting, null, 20, 'inactivitat: entra des de waiting list', null);\r\n  end if;\r\n\r\n  ok := true;\r\n  reason := format('Jugador %s inactiu: surt del rànquing; promogut %s', p_player_id, coalesce(v_first_waiting::text,'cap'));\r\n  return next;\r\nend;\r\n$function$\n",
    "arguments": "p_player_id uuid, p_event_id uuid",
    "return_type": "record",
    "volatility": "VOLATILE",
    "security_definer": false,
    "is_strict": false,
    "returns_set": true,
    "is_leakproof": false
  },
  {
    "function_name": "apply_match_result",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.apply_match_result(p_challenge uuid)\n RETURNS record\n LANGUAGE plpgsql\n STABLE\nAS $function$\r\ndeclare\r\n  v_event uuid;\r\n  v_reptador uuid;\r\n  v_reptat uuid;\r\n  v_pos_r smallint;\r\n  v_pos_t smallint;\r\n  v_result text;\r\nbegin\r\n  -- Dades bàsiques del repte\r\n  select c.event_id, c.reptador_id, c.reptat_id, c.pos_reptador, c.pos_reptat\r\n    into v_event, v_reptador, v_reptat, v_pos_r, v_pos_t\r\n  from challenges c\r\n  where c.id = p_challenge;\r\n\r\n  if v_event is null then\r\n    return (false, 'challenge_not_found');\r\n  end if;\r\n\r\n  -- Darrer resultat registrat del partit vinculat\r\n  select m.resultat::text\r\n    into v_result\r\n  from matches m\r\n  where m.challenge_id = p_challenge\r\n  order by m.creat_el desc\r\n  limit 1;\r\n\r\n  if v_result is null then\r\n    return (false, 'match_not_found');\r\n  end if;\r\n\r\n  if v_pos_r is null or v_pos_t is null or v_pos_r = v_pos_t then\r\n    return (false, 'positions_missing_or_equal');\r\n  end if;\r\n\r\n  -- Només hi ha intercanvi si guanya el reptador\r\n  if v_result = 'reptador' then\r\n    update ranking_positions rp\r\n       set posicio = case\r\n                       when rp.player_id = v_reptador then v_pos_t\r\n                       when rp.player_id = v_reptat   then v_pos_r\r\n                       else rp.posicio\r\n                     end\r\n     where rp.event_id = v_event\r\n       and rp.player_id in (v_reptador, v_reptat);\r\n\r\n    insert into history_position_changes(\r\n      event_id, player_id, posicio_anterior, posicio_nova, motiu, ref_challenge\r\n    )\r\n    values\r\n      (v_event, v_reptador, v_pos_r, v_pos_t, 'victòria repte', p_challenge),\r\n      (v_event, v_reptat,   v_pos_t, v_pos_r, 'derrota repte',  p_challenge);\r\n  end if;\r\n\r\n  return (true, null::text);\r\nend$function$\n",
    "arguments": "p_challenge uuid",
    "return_type": "record",
    "volatility": "STABLE",
    "security_definer": false,
    "is_strict": false,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "apply_no_show_win",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.apply_no_show_win(p_challenge uuid, p_quies_no_show uuid)\n RETURNS void\n LANGUAGE plpgsql\nAS $function$\r\ndeclare\r\n  c record;\r\n  guanyador uuid;\r\n  perdedor uuid;\r\n  motiu text;\r\nbegin\r\n  select * into c from public.challenges where id=p_challenge;\r\n  if c is null then raise exception 'Repte inexistent'; end if;\r\n\r\n  if p_quies_no_show = c.reptat_id then\r\n    guanyador := c.reptador_id; perdedor := c.reptat_id;\r\n    motiu := 'Incompareixença del reptat';\r\n  elsif p_quies_no_show = c.reptador_id then\r\n    -- (no definit explícitament a la normativa, però assumim simetria)\r\n    guanyador := c.reptat_id; perdedor := c.reptador_id;\r\n    motiu := 'Incompareixença del reptador';\r\n  else\r\n    raise exception 'El jugador indicat no forma part del repte';\r\n  end if;\r\n\r\n  -- registrar penalització\r\n  insert into public.penalties(event_id, player_id, tipus, detalls)\r\n  values (c.event_id, p_quies_no_show, 'incompareixenca', motiu);\r\n\r\n  -- si guanya el reptador (cas normatiu), intercanvi directe\r\n  if guanyador = c.reptador_id then\r\n    perform public.swap_positions(c.event_id, c.reptador_id, c.reptat_id, 'Victòria per incompareixença', c.id);\r\n  end if;\r\n\r\n  update public.challenges set estat='anullat' where id=p_challenge;\r\nend $function$\n",
    "arguments": "p_challenge uuid, p_quies_no_show uuid",
    "return_type": "void",
    "volatility": "VOLATILE",
    "security_definer": false,
    "is_strict": false,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "apply_pre_inactivity",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.apply_pre_inactivity(p_event uuid)\n RETURNS void\n LANGUAGE plpgsql\n SECURITY DEFINER\n SET search_path TO 'public'\nAS $function$\r\nDECLARE\r\n  r RECORD;\r\n  v_old_pos INTEGER;\r\n  v_new_pos INTEGER;\r\n  v_waiting uuid;\r\n  v_new_order INTEGER;\r\n  v_moved RECORD;\r\nBEGIN\r\n  FOR r IN\r\n    SELECT rp.player_id\r\n      FROM ranking_positions rp\r\n     WHERE rp.event_id = p_event\r\n       AND NOT EXISTS (\r\n         SELECT 1\r\n           FROM challenges c\r\n      LEFT JOIN matches m ON m.challenge_id = c.id\r\n          WHERE c.event_id = p_event\r\n            AND (c.reptador_id = rp.player_id\r\n                 OR c.reptat_id = rp.player_id)\r\n            AND (\r\n              (c.estat = 'programat'\r\n               AND c.data_programada >= NOW() - INTERVAL '21 days')\r\n              OR\r\n              (c.estat = 'jugat'\r\n               AND m.data_joc >= NOW() - INTERVAL '21 days')\r\n            )\r\n       )\r\n     ORDER BY rp.posicio\r\n  LOOP\r\n    SELECT posicio INTO v_old_pos\r\n      FROM ranking_positions\r\n     WHERE event_id = p_event AND player_id = r.player_id;\r\n\r\n    IF v_old_pos IS NULL THEN\r\n      CONTINUE;\r\n    END IF;\r\n\r\n    v_new_pos := v_old_pos + 5;\r\n\r\n    -- Puja jugadors intermedis\r\n    FOR v_moved IN\r\n      SELECT player_id, posicio\r\n        FROM ranking_positions\r\n       WHERE event_id = p_event\r\n         AND posicio > v_old_pos\r\n         AND posicio <= v_old_pos + 5\r\n       ORDER BY posicio\r\n    LOOP\r\n      UPDATE ranking_positions\r\n         SET posicio = v_moved.posicio - 1\r\n       WHERE event_id = p_event AND player_id = v_moved.player_id;\r\n\r\n      INSERT INTO history_position_changes(\r\n        event_id, player_id, posicio_anterior, posicio_nova,\r\n        motiu, ref_challenge\r\n      )\r\n      VALUES (\r\n        p_event,\r\n        v_moved.player_id,\r\n        v_moved.posicio,\r\n        v_moved.posicio - 1,\r\n        'puja per pre-inactivitat',\r\n        NULL\r\n      );\r\n    END LOOP;\r\n\r\n    -- Mou el jugador penalitzat\r\n    IF v_new_pos > 20 THEN\r\n      SELECT player_id INTO v_waiting\r\n        FROM waiting_list\r\n       WHERE event_id = p_event\r\n       ORDER BY ordre\r\n       LIMIT 1;\r\n\r\n      SELECT COALESCE(MAX(ordre),0) + 1 INTO v_new_order\r\n        FROM waiting_list\r\n       WHERE event_id = p_event;\r\n\r\n      INSERT INTO waiting_list(event_id, player_id, ordre)\r\n      VALUES (p_event, r.player_id, v_new_order);\r\n\r\n      DELETE FROM ranking_positions\r\n        WHERE event_id = p_event AND player_id = r.player_id;\r\n\r\n      INSERT INTO history_position_changes(\r\n        event_id, player_id, posicio_anterior, posicio_nova,\r\n        motiu, ref_challenge\r\n      )\r\n      VALUES (\r\n        p_event,\r\n        r.player_id,\r\n        v_old_pos,\r\n        NULL,\r\n        'baixa per pre-inactivitat',\r\n        NULL\r\n      );\r\n\r\n      IF v_waiting IS NOT NULL THEN\r\n        INSERT INTO ranking_positions(event_id, player_id, posicio)\r\n        VALUES (p_event, v_waiting, 20);\r\n\r\n        DELETE FROM waiting_list\r\n          WHERE event_id = p_event AND player_id = v_waiting;\r\n\r\n        INSERT INTO history_position_changes(\r\n          event_id, player_id, posicio_anterior, posicio_nova,\r\n          motiu, ref_challenge\r\n        )\r\n        VALUES (\r\n          p_event,\r\n          v_waiting,\r\n          NULL,\r\n          20,\r\n          'entra per pre-inactivitat',\r\n          NULL\r\n        );\r\n      END IF;\r\n    ELSE\r\n      UPDATE ranking_positions\r\n         SET posicio = v_new_pos\r\n       WHERE event_id = p_event AND player_id = r.player_id;\r\n\r\n      INSERT INTO history_position_changes(\r\n        event_id, player_id, posicio_anterior, posicio_nova,\r\n        motiu, ref_challenge\r\n      )\r\n      VALUES (\r\n        p_event,\r\n        r.player_id,\r\n        v_old_pos,\r\n        v_new_pos,\r\n        'baixa per pre-inactivitat',\r\n        NULL\r\n      );\r\n    END IF;\r\n  END LOOP;\r\nEND;\r\n$function$\n",
    "arguments": "p_event uuid",
    "return_type": "void",
    "volatility": "VOLATILE",
    "security_definer": true,
    "is_strict": false,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "apply_pre_inactivity",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.apply_pre_inactivity(p_player_id uuid, p_event_id uuid)\n RETURNS TABLE(ok boolean, reason text)\n LANGUAGE plpgsql\nAS $function$\r\ndeclare\r\n  v_pos smallint;\r\n  v_new_pos smallint;\r\n  v_max smallint;\r\nbegin\r\n  select posicio into v_pos\r\n  from public.ranking_positions\r\n  where event_id = p_event_id and player_id = p_player_id;\r\n\r\n  if v_pos is null then\r\n    ok := false; reason := 'jugador no trobat al rànquing'; return next; return;\r\n  end if;\r\n\r\n  v_new_pos := v_pos + 5;\r\n\r\n  -- Quina és la posició màxima permesa?\r\n  select max(posicio) into v_max\r\n  from public.ranking_positions\r\n  where event_id = p_event_id;\r\n\r\n  if v_new_pos > v_max then\r\n    -- passa a la waiting_list (últim lloc)\r\n    delete from public.ranking_positions\r\n     where event_id = p_event_id and player_id = p_player_id;\r\n\r\n    insert into public.waiting_list (player_id, ordre, event_id, data_inscripcio)\r\n    values (p_player_id,\r\n            (select coalesce(max(ordre),0)+1 from public.waiting_list),\r\n            p_event_id,\r\n            now());\r\n\r\n    ok := true;\r\n    reason := format('Jugador %s pre-inactiu: surt del rànquing i entra a waiting list', p_player_id);\r\n    return next;\r\n  else\r\n    -- moure'l a v_new_pos i recalculem els altres\r\n    update public.ranking_positions\r\n       set posicio = posicio - 1\r\n     where event_id = p_event_id\r\n       and posicio between v_pos+1 and v_new_pos;\r\n\r\n    update public.ranking_positions\r\n       set posicio = v_new_pos\r\n     where event_id = p_event_id\r\n       and player_id = p_player_id;\r\n\r\n    insert into public.history_position_changes\r\n      (event_id, player_id, posicio_anterior, posicio_nova, motiu, ref_challenge)\r\n    values\r\n      (p_event_id, p_player_id, v_pos, v_new_pos, 'pre-inactivitat (-5 posicions)', null);\r\n\r\n    ok := true;\r\n    reason := format('Jugador %s baixa de %s a %s per pre-inactivitat', p_player_id, v_pos, v_new_pos);\r\n    return next;\r\n  end if;\r\nend;\r\n$function$\n",
    "arguments": "p_player_id uuid, p_event_id uuid",
    "return_type": "record",
    "volatility": "VOLATILE",
    "security_definer": false,
    "is_strict": false,
    "returns_set": true,
    "is_leakproof": false
  },
  {
    "function_name": "apply_voluntary_drop",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.apply_voluntary_drop(p_event uuid, p_player uuid)\n RETURNS void\n LANGUAGE plpgsql\n SECURITY DEFINER\n SET search_path TO 'public'\nAS $function$\r\nDECLARE\r\n  b RECORD;\r\n  v_pos  INTEGER;\r\n  v_wait uuid;\r\nBEGIN\r\n  SELECT posicio INTO v_pos\r\n    FROM ranking_positions\r\n   WHERE event_id = p_event AND player_id = p_player;\r\n\r\n  IF v_pos IS NULL THEN\r\n    RETURN;\r\n  END IF;\r\n\r\n  DELETE FROM ranking_positions\r\n   WHERE event_id = p_event AND player_id = p_player;\r\n\r\n  INSERT INTO history_position_changes(\r\n    event_id, player_id, posicio_anterior, posicio_nova,\r\n    motiu, ref_challenge\r\n  )\r\n  VALUES (p_event, p_player, v_pos, NULL, 'baixa', NULL);\r\n\r\n  FOR b IN\r\n    SELECT player_id, posicio\r\n      FROM ranking_positions\r\n     WHERE event_id = p_event AND posicio > v_pos\r\n     ORDER BY posicio\r\n  LOOP\r\n    UPDATE ranking_positions\r\n       SET posicio = b.posicio - 1\r\n     WHERE event_id = p_event AND player_id = b.player_id;\r\n\r\n    INSERT INTO history_position_changes(\r\n      event_id, player_id, posicio_anterior, posicio_nova,\r\n      motiu, ref_challenge\r\n    )\r\n    VALUES (\r\n      p_event,\r\n      b.player_id,\r\n      b.posicio,\r\n      b.posicio - 1,\r\n      'puja per baixa',\r\n      NULL\r\n    );\r\n  END LOOP;\r\n\r\n  SELECT player_id INTO v_wait\r\n    FROM waiting_list\r\n   WHERE event_id = p_event\r\n   ORDER BY ordre\r\n   LIMIT 1;\r\n\r\n  IF v_wait IS NOT NULL THEN\r\n    INSERT INTO ranking_positions(event_id, player_id, posicio)\r\n    VALUES (p_event, v_wait, 20);\r\n\r\n    DELETE FROM waiting_list\r\n      WHERE event_id = p_event AND player_id = v_wait;\r\n\r\n    INSERT INTO history_position_changes(\r\n      event_id, player_id, posicio_anterior, posicio_nova,\r\n      motiu, ref_challenge\r\n    )\r\n    VALUES (p_event, v_wait, NULL, 20, 'entra per baixa', NULL);\r\n  END IF;\r\nEND;\r\n$function$\n",
    "arguments": "p_event uuid, p_player uuid",
    "return_type": "void",
    "volatility": "VOLATILE",
    "security_definer": true,
    "is_strict": false,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "apply_voluntary_leave",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.apply_voluntary_leave(p_player_id uuid, p_event_id uuid)\n RETURNS TABLE(ok boolean, reason text)\n LANGUAGE plpgsql\nAS $function$\r\ndeclare\r\n  v_pos smallint;\r\n  v_first_waiting uuid;\r\nbegin\r\n  select posicio into v_pos\r\n  from public.ranking_positions\r\n  where event_id = p_event_id and player_id = p_player_id;\r\n\r\n  if v_pos is null then\r\n    ok := false; reason := 'jugador no trobat al rànquing'; return next; return;\r\n  end if;\r\n\r\n  -- elimina del rànquing\r\n  delete from public.ranking_positions\r\n   where event_id = p_event_id and player_id = p_player_id;\r\n\r\n  -- promou primer de la waiting list\r\n  select player_id into v_first_waiting\r\n  from public.waiting_list\r\n  where event_id = p_event_id\r\n  order by ordre asc\r\n  limit 1;\r\n\r\n  if v_first_waiting is not null then\r\n    insert into public.ranking_positions (event_id, posicio, player_id, assignat_el)\r\n    values (p_event_id, 20, v_first_waiting, now());\r\n\r\n    delete from public.waiting_list\r\n     where event_id = p_event_id and player_id = v_first_waiting;\r\n\r\n    insert into public.history_position_changes\r\n      (event_id, player_id, posicio_anterior, posicio_nova, motiu, ref_challenge)\r\n    values\r\n      (p_event_id, v_first_waiting, null, 20, 'baixa voluntària: entra des de waiting list', null);\r\n  end if;\r\n\r\n  ok := true;\r\n  reason := format('Jugador %s baixa voluntària; promogut %s', p_player_id, coalesce(v_first_waiting::text,'cap'));\r\n  return next;\r\nend;\r\n$function$\n",
    "arguments": "p_player_id uuid, p_event_id uuid",
    "return_type": "record",
    "volatility": "VOLATILE",
    "security_definer": false,
    "is_strict": false,
    "returns_set": true,
    "is_leakproof": false
  },
  {
    "function_name": "can_create_challenge",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.can_create_challenge(p_event uuid, p_reptador uuid, p_reptat uuid)\n RETURNS boolean\n LANGUAGE plpgsql\n STABLE\nAS $function$\r\ndeclare\r\n  v_max_gap integer;\r\n  v_cd_min integer;\r\n  v_cd_max integer;\r\n  v_pos_reptador integer;\r\n  v_pos_reptat integer;\r\n  v_last timestamp with time zone;\r\n  v_days integer;\r\nbegin\r\n  select coalesce(max_rank_gap, 2),\r\n         coalesce(cooldown_min_dies, 7),\r\n         cooldown_max_dies\r\n    into v_max_gap, v_cd_min, v_cd_max\r\n    from app_settings\r\n   order by updated_at desc limit 1;\r\n\r\n  if p_reptador = p_reptat then\r\n    return false;\r\n  end if;\r\n\r\n  if not exists (select 1 from events where id = p_event and actiu) then\r\n    return false;\r\n  end if;\r\n\r\n  if not exists (select 1 from players where id = p_reptador and estat='actiu') then\r\n    return false;\r\n  end if;\r\n  if not exists (select 1 from players where id = p_reptat and estat='actiu') then\r\n    return false;\r\n  end if;\r\n\r\n  select posicio into v_pos_reptador\r\n    from ranking_positions where event_id=p_event and player_id=p_reptador;\r\n  select posicio into v_pos_reptat\r\n    from ranking_positions where event_id=p_event and player_id=p_reptat;\r\n\r\n  if v_pos_reptador is null or v_pos_reptat is null then\r\n    return false;\r\n  end if;\r\n\r\n  if abs(v_pos_reptador - v_pos_reptat) > v_max_gap then\r\n    return false;\r\n  end if;\r\n\r\n  if exists (\r\n    select 1 from challenges\r\n     where event_id=p_event\r\n       and estat in ('proposat','acceptat','programat')\r\n       and (reptador_id in (p_reptador,p_reptat) or reptat_id in (p_reptador,p_reptat))\r\n  ) then\r\n    return false;\r\n  end if;\r\n\r\n  select max(coalesce(data_joc,data_acceptacio,data_proposta))\r\n    into v_last\r\n    from challenges\r\n   where event_id=p_event\r\n     and ((reptador_id=p_reptador and reptat_id=p_reptat) or\r\n          (reptador_id=p_reptat and reptat_id=p_reptador))\r\n     and estat not in ('proposat','acceptat','programat');\r\n\r\n  if v_last is not null then\r\n    v_days := (now()::date - v_last::date);\r\n    if v_days < v_cd_min then\r\n      return false;\r\n    end if;\r\n    if v_cd_max is not null and v_days > v_cd_max then\r\n      return false;\r\n    end if;\r\n  end if;\r\n\r\n  return true;\r\nend$function$\n",
    "arguments": "p_event uuid, p_reptador uuid, p_reptat uuid",
    "return_type": "bool",
    "volatility": "STABLE",
    "security_definer": false,
    "is_strict": false,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "can_create_challenge_detail",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.can_create_challenge_detail(p_event uuid, p_reptador uuid, p_reptat uuid)\n RETURNS json\n LANGUAGE plpgsql\n STABLE\nAS $function$\r\ndeclare\r\n  v_max_gap integer;\r\n  v_cd_min integer;\r\n  v_cd_max integer;\r\n  v_pos_reptador integer;\r\n  v_pos_reptat integer;\r\n  v_last timestamp with time zone;\r\n  v_days integer;\r\nbegin\r\n  select coalesce(max_rank_gap, 2),\r\n         coalesce(cooldown_min_dies, 7),\r\n         cooldown_max_dies\r\n    into v_max_gap, v_cd_min, v_cd_max\r\n    from app_settings\r\n   order by updated_at desc limit 1;\r\n\r\n  if p_reptador = p_reptat then\r\n    return json_build_object('ok',false,'reason','No et pots reptar a tu mateix');\r\n  end if;\r\n\r\n  if not exists (select 1 from events where id = p_event and actiu) then\r\n    return json_build_object('ok',false,'reason','Event inactiu');\r\n  end if;\r\n\r\n  if not exists (select 1 from players where id = p_reptador and estat='actiu') then\r\n    return json_build_object('ok',false,'reason','Reptador inactiu');\r\n  end if;\r\n  if not exists (select 1 from players where id = p_reptat and estat='actiu') then\r\n    return json_build_object('ok',false,'reason','Reptat inactiu');\r\n  end if;\r\n\r\n  select posicio into v_pos_reptador\r\n    from ranking_positions where event_id=p_event and player_id=p_reptador;\r\n  select posicio into v_pos_reptat\r\n    from ranking_positions where event_id=p_event and player_id=p_reptat;\r\n\r\n  if v_pos_reptador is null then\r\n    return json_build_object('ok',false,'reason','El reptador no és al rànquing');\r\n  end if;\r\n  if v_pos_reptat is null then\r\n    return json_build_object('ok',false,'reason','El reptat no és al rànquing');\r\n  end if;\r\n\r\n  if abs(v_pos_reptador - v_pos_reptat) > v_max_gap then\r\n    return json_build_object('ok',false,'reason','Diferència de posicions massa gran');\r\n  end if;\r\n\r\n  if exists (\r\n    select 1 from challenges\r\n     where event_id=p_event\r\n       and estat in ('proposat','acceptat','programat')\r\n       and (reptador_id in (p_reptador,p_reptat) or reptat_id in (p_reptador,p_reptat))\r\n  ) then\r\n    return json_build_object('ok',false,'reason','Ja hi ha un repte actiu');\r\n  end if;\r\n\r\n  select max(coalesce(data_joc,data_acceptacio,data_proposta))\r\n    into v_last\r\n    from challenges\r\n   where event_id=p_event\r\n     and ((reptador_id=p_reptador and reptat_id=p_reptat) or\r\n          (reptador_id=p_reptat and reptat_id=p_reptador))\r\n     and estat not in ('proposat','acceptat','programat');\r\n\r\n  if v_last is not null then\r\n    v_days := (now()::date - v_last::date);\r\n    if v_days < v_cd_min then\r\n      return json_build_object('ok',false,'reason','Temps mínim entre reptes no complert');\r\n    end if;\r\n    if v_cd_max is not null and v_days > v_cd_max then\r\n      return json_build_object('ok',false,'reason','Temps màxim entre reptes excedit');\r\n    end if;\r\n  end if;\r\n\r\n  return json_build_object('ok',true,'reason',null);\r\nend$function$\n",
    "arguments": "p_event uuid, p_reptador uuid, p_reptat uuid",
    "return_type": "json",
    "volatility": "STABLE",
    "security_definer": false,
    "is_strict": false,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "capture_initial_ranking",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.capture_initial_ranking(p_event uuid)\n RETURNS void\n LANGUAGE plpgsql\n SECURITY DEFINER\n SET search_path TO 'public'\nAS $function$\r\nbegin\r\n  perform capture_weekly_ranking(p_event);\r\nend;\r\n$function$\n",
    "arguments": "p_event uuid",
    "return_type": "void",
    "volatility": "VOLATILE",
    "security_definer": true,
    "is_strict": false,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "capture_weekly_ranking",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.capture_weekly_ranking(p_event uuid)\n RETURNS void\n LANGUAGE plpgsql\n SECURITY DEFINER\n SET search_path TO 'public'\nAS $function$\r\ndeclare\r\n  v_event uuid;\r\n  v_week integer;\r\nbegin\r\n  if p_event is null then\r\n    select id into v_event from events where actiu is true limit 1;\r\n  else\r\n    v_event := p_event;\r\n  end if;\r\n\r\n  select coalesce(max(setmana), 0) + 1 into v_week\r\n    from player_weekly_positions\r\n    where event_id = v_event;\r\n\r\n  insert into player_weekly_positions(event_id, player_id, setmana, posicio)\r\n  select rp.event_id, rp.player_id, v_week, rp.posicio\r\n    from ranking_positions rp\r\n    where rp.event_id = v_event;\r\nend;\r\n$function$\n",
    "arguments": "p_event uuid",
    "return_type": "void",
    "volatility": "VOLATILE",
    "security_definer": true,
    "is_strict": false,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "cash_dist",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.cash_dist(money, money)\n RETURNS money\n LANGUAGE c\n IMMUTABLE PARALLEL SAFE STRICT\nAS '$libdir/btree_gist', $function$cash_dist$function$\n",
    "arguments": "money, money",
    "return_type": "money",
    "volatility": "IMMUTABLE",
    "security_definer": false,
    "is_strict": true,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "create_challenge",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.create_challenge(_reptador uuid, _reptat uuid, _tipus challenge_type)\n RETURNS uuid\n LANGUAGE plpgsql\n SECURITY DEFINER\nAS $function$\r\ndeclare\r\n  _event_id uuid;\r\n  pos_r smallint; pos_t smallint;\r\n  cooldown_min int; cooldown_max int;\r\nbegin\r\n  select id into _event_id from public.events where actiu limit 1;\r\n  if _event_id is null then raise exception 'No active event';\r\n  end if;\r\n\r\n  -- Un repte actiu per jugador\r\n  if exists (select 1 from public.challenges\r\n             where estat in ('proposat','acceptat') and (reptador_id=_reptador or reptat_id=_reptador))\r\n  then raise exception 'El reptador ja té un repte actiu';\r\n  end if;\r\n  if exists (select 1 from public.challenges\r\n             where estat in ('proposat','acceptat') and (reptador_id=_reptat or reptat_id=_reptat))\r\n  then raise exception 'El reptat ja té un repte actiu';\r\n  end if;\r\n\r\n  -- Posicions actuals\r\n  select posicio into pos_r from public.ranking_positions where event_id=_event_id and player_id=_reptador;\r\n  select posicio into pos_t from public.ranking_positions where event_id=_event_id and player_id=_reptat;\r\n\r\n  if _tipus='normal' then\r\n    if pos_r is null or pos_t is null then\r\n      raise exception 'Repte normal requereix que ambdós siguin al rànquing';\r\n    end if;\r\n    if abs(pos_t - pos_r) > 2 then\r\n      raise exception 'Només pots reptar fins a 2 posicions amunt/avall';\r\n    end if;\r\n  end if;\r\n\r\n  -- cool-down\r\n  select cooldown_min_dies, cooldown_max_dies into cooldown_min, cooldown_max from public.app_settings limit 1;\r\n  if exists (\r\n     select 1 from public.challenges c\r\n     join public.matches m on m.challenge_id=c.id\r\n     where (c.reptador_id=_reptador or c.reptat_id=_reptador)\r\n       and m.data_joc >= now() - make_interval(days => cooldown_min)\r\n  ) then\r\n     raise exception 'Cal respectar el cooldown mínim de % dies', cooldown_min;\r\n  end if;\r\n\r\n  insert into public.challenges(event_id, tipus, reptador_id, reptat_id, estat,\r\n                                dates_proposades, pos_reptador, pos_reptat)\r\n  values (_event_id, _tipus, _reptador, _reptat, 'proposat', '{}', pos_r, pos_t)\r\n  returning id into _event_id;\r\n  return _event_id;\r\nend$function$\n",
    "arguments": "_reptador uuid, _reptat uuid, _tipus challenge_type",
    "return_type": "uuid",
    "volatility": "VOLATILE",
    "security_definer": true,
    "is_strict": false,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "current_player_id",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.current_player_id()\n RETURNS uuid\n LANGUAGE sql\n STABLE\nAS $function$\r\n  select p.id\r\n  from public.players p\r\n  where p.email = (auth.jwt() ->> 'email')\r\n  limit 1\r\n$function$\n",
    "arguments": "",
    "return_type": "uuid",
    "volatility": "STABLE",
    "security_definer": false,
    "is_strict": false,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "date_dist",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.date_dist(date, date)\n RETURNS integer\n LANGUAGE c\n IMMUTABLE PARALLEL SAFE STRICT\nAS '$libdir/btree_gist', $function$date_dist$function$\n",
    "arguments": "date, date",
    "return_type": "int4",
    "volatility": "IMMUTABLE",
    "security_definer": false,
    "is_strict": true,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "enforce_max_rank_gap",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.enforce_max_rank_gap()\n RETURNS trigger\n LANGUAGE plpgsql\nAS $function$\r\nDECLARE\r\n  gap smallint;\r\n  s_max smallint;\r\nBEGIN\r\n  SELECT max_rank_gap INTO s_max\r\n  FROM public.app_settings\r\n  ORDER BY updated_at DESC\r\n  LIMIT 1;\r\n\r\n  -- obtenim posicions actuals\r\n  WITH rp AS (\r\n    SELECT player_id, posicio\r\n    FROM public.ranking_positions\r\n    WHERE event_id = NEW.event_id\r\n  )\r\n  SELECT (rpr.posicio - rpt.posicio) INTO gap\r\n  FROM rp rpr\r\n  JOIN rp rpt ON rpr.player_id = NEW.reptat_id AND rpt.player_id = NEW.reptador_id;\r\n\r\n  IF gap IS NULL THEN\r\n    RAISE EXCEPTION 'No es troben les posicions de reptador/reptat per a l''event %', NEW.event_id;\r\n  END IF;\r\n\r\n  IF gap > s_max THEN\r\n    RAISE EXCEPTION 'No pots reptar més de % posicions per sobre (gap=%)', s_max, gap;\r\n  END IF;\r\n\r\n  RETURN NEW;\r\nEND $function$\n",
    "arguments": "",
    "return_type": "trigger",
    "volatility": "VOLATILE",
    "security_definer": false,
    "is_strict": false,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "float4_dist",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.float4_dist(real, real)\n RETURNS real\n LANGUAGE c\n IMMUTABLE PARALLEL SAFE STRICT\nAS '$libdir/btree_gist', $function$float4_dist$function$\n",
    "arguments": "real, real",
    "return_type": "float4",
    "volatility": "IMMUTABLE",
    "security_definer": false,
    "is_strict": true,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "float8_dist",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.float8_dist(double precision, double precision)\n RETURNS double precision\n LANGUAGE c\n IMMUTABLE PARALLEL SAFE STRICT\nAS '$libdir/btree_gist', $function$float8_dist$function$\n",
    "arguments": "double precision, double precision",
    "return_type": "float8",
    "volatility": "IMMUTABLE",
    "security_definer": false,
    "is_strict": true,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "fn_challenges_set_positions",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.fn_challenges_set_positions()\n RETURNS trigger\n LANGUAGE plpgsql\nAS $function$\r\nBEGIN\r\n  IF NEW.pos_reptador IS NULL THEN\r\n    SELECT posicio INTO NEW.pos_reptador\r\n    FROM ranking_positions\r\n    WHERE event_id = NEW.event_id AND player_id = NEW.reptador_id;\r\n  END IF;\r\n\r\n  IF NEW.pos_reptat IS NULL THEN\r\n    SELECT posicio INTO NEW.pos_reptat\r\n    FROM ranking_positions\r\n    WHERE event_id = NEW.event_id AND player_id = NEW.reptat_id;\r\n  END IF;\r\n\r\n  RETURN NEW;\r\nEND;\r\n$function$\n",
    "arguments": "",
    "return_type": "trigger",
    "volatility": "VOLATILE",
    "security_definer": false,
    "is_strict": false,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "fn_matches_finalize",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.fn_matches_finalize()\n RETURNS trigger\n LANGUAGE plpgsql\nAS $function$\r\nBEGIN\r\n  UPDATE challenges\r\n     SET estat = 'jugat'\r\n   WHERE id = NEW.challenge_id;\r\n\r\n  UPDATE players\r\n     SET data_ultim_repte = NEW.data_joc::date\r\n   WHERE id IN (\r\n       SELECT reptador_id FROM challenges WHERE id = NEW.challenge_id\r\n       UNION\r\n       SELECT reptat_id   FROM challenges WHERE id = NEW.challenge_id\r\n   );\r\n\r\n  RETURN NEW;\r\nEND;\r\n$function$\n",
    "arguments": "",
    "return_type": "trigger",
    "volatility": "VOLATILE",
    "security_definer": false,
    "is_strict": false,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "gbt_bit_compress",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.gbt_bit_compress(internal)\n RETURNS internal\n LANGUAGE c\n IMMUTABLE PARALLEL SAFE STRICT\nAS '$libdir/btree_gist', $function$gbt_bit_compress$function$\n",
    "arguments": "internal",
    "return_type": "internal",
    "volatility": "IMMUTABLE",
    "security_definer": false,
    "is_strict": true,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "gbt_bit_consistent",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.gbt_bit_consistent(internal, bit, smallint, oid, internal)\n RETURNS boolean\n LANGUAGE c\n IMMUTABLE PARALLEL SAFE STRICT\nAS '$libdir/btree_gist', $function$gbt_bit_consistent$function$\n",
    "arguments": "internal, bit, smallint, oid, internal",
    "return_type": "bool",
    "volatility": "IMMUTABLE",
    "security_definer": false,
    "is_strict": true,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "gbt_bit_penalty",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.gbt_bit_penalty(internal, internal, internal)\n RETURNS internal\n LANGUAGE c\n IMMUTABLE PARALLEL SAFE STRICT\nAS '$libdir/btree_gist', $function$gbt_bit_penalty$function$\n",
    "arguments": "internal, internal, internal",
    "return_type": "internal",
    "volatility": "IMMUTABLE",
    "security_definer": false,
    "is_strict": true,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "gbt_bit_picksplit",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.gbt_bit_picksplit(internal, internal)\n RETURNS internal\n LANGUAGE c\n IMMUTABLE PARALLEL SAFE STRICT\nAS '$libdir/btree_gist', $function$gbt_bit_picksplit$function$\n",
    "arguments": "internal, internal",
    "return_type": "internal",
    "volatility": "IMMUTABLE",
    "security_definer": false,
    "is_strict": true,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "gbt_bit_same",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.gbt_bit_same(gbtreekey_var, gbtreekey_var, internal)\n RETURNS internal\n LANGUAGE c\n IMMUTABLE PARALLEL SAFE STRICT\nAS '$libdir/btree_gist', $function$gbt_bit_same$function$\n",
    "arguments": "gbtreekey_var, gbtreekey_var, internal",
    "return_type": "internal",
    "volatility": "IMMUTABLE",
    "security_definer": false,
    "is_strict": true,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "gbt_bit_union",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.gbt_bit_union(internal, internal)\n RETURNS gbtreekey_var\n LANGUAGE c\n IMMUTABLE PARALLEL SAFE STRICT\nAS '$libdir/btree_gist', $function$gbt_bit_union$function$\n",
    "arguments": "internal, internal",
    "return_type": "gbtreekey_var",
    "volatility": "IMMUTABLE",
    "security_definer": false,
    "is_strict": true,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "gbt_bool_compress",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.gbt_bool_compress(internal)\n RETURNS internal\n LANGUAGE c\n IMMUTABLE STRICT\nAS '$libdir/btree_gist', $function$gbt_bool_compress$function$\n",
    "arguments": "internal",
    "return_type": "internal",
    "volatility": "IMMUTABLE",
    "security_definer": false,
    "is_strict": true,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "gbt_bool_consistent",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.gbt_bool_consistent(internal, boolean, smallint, oid, internal)\n RETURNS boolean\n LANGUAGE c\n IMMUTABLE STRICT\nAS '$libdir/btree_gist', $function$gbt_bool_consistent$function$\n",
    "arguments": "internal, boolean, smallint, oid, internal",
    "return_type": "bool",
    "volatility": "IMMUTABLE",
    "security_definer": false,
    "is_strict": true,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "gbt_bool_fetch",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.gbt_bool_fetch(internal)\n RETURNS internal\n LANGUAGE c\n IMMUTABLE STRICT\nAS '$libdir/btree_gist', $function$gbt_bool_fetch$function$\n",
    "arguments": "internal",
    "return_type": "internal",
    "volatility": "IMMUTABLE",
    "security_definer": false,
    "is_strict": true,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "gbt_bool_penalty",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.gbt_bool_penalty(internal, internal, internal)\n RETURNS internal\n LANGUAGE c\n IMMUTABLE STRICT\nAS '$libdir/btree_gist', $function$gbt_bool_penalty$function$\n",
    "arguments": "internal, internal, internal",
    "return_type": "internal",
    "volatility": "IMMUTABLE",
    "security_definer": false,
    "is_strict": true,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "gbt_bool_picksplit",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.gbt_bool_picksplit(internal, internal)\n RETURNS internal\n LANGUAGE c\n IMMUTABLE STRICT\nAS '$libdir/btree_gist', $function$gbt_bool_picksplit$function$\n",
    "arguments": "internal, internal",
    "return_type": "internal",
    "volatility": "IMMUTABLE",
    "security_definer": false,
    "is_strict": true,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "gbt_bool_same",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.gbt_bool_same(gbtreekey2, gbtreekey2, internal)\n RETURNS internal\n LANGUAGE c\n IMMUTABLE STRICT\nAS '$libdir/btree_gist', $function$gbt_bool_same$function$\n",
    "arguments": "gbtreekey2, gbtreekey2, internal",
    "return_type": "internal",
    "volatility": "IMMUTABLE",
    "security_definer": false,
    "is_strict": true,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "gbt_bool_union",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.gbt_bool_union(internal, internal)\n RETURNS gbtreekey2\n LANGUAGE c\n IMMUTABLE STRICT\nAS '$libdir/btree_gist', $function$gbt_bool_union$function$\n",
    "arguments": "internal, internal",
    "return_type": "gbtreekey2",
    "volatility": "IMMUTABLE",
    "security_definer": false,
    "is_strict": true,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "gbt_bpchar_compress",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.gbt_bpchar_compress(internal)\n RETURNS internal\n LANGUAGE c\n IMMUTABLE PARALLEL SAFE STRICT\nAS '$libdir/btree_gist', $function$gbt_bpchar_compress$function$\n",
    "arguments": "internal",
    "return_type": "internal",
    "volatility": "IMMUTABLE",
    "security_definer": false,
    "is_strict": true,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "gbt_bpchar_consistent",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.gbt_bpchar_consistent(internal, character, smallint, oid, internal)\n RETURNS boolean\n LANGUAGE c\n IMMUTABLE PARALLEL SAFE STRICT\nAS '$libdir/btree_gist', $function$gbt_bpchar_consistent$function$\n",
    "arguments": "internal, character, smallint, oid, internal",
    "return_type": "bool",
    "volatility": "IMMUTABLE",
    "security_definer": false,
    "is_strict": true,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "gbt_bytea_compress",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.gbt_bytea_compress(internal)\n RETURNS internal\n LANGUAGE c\n IMMUTABLE PARALLEL SAFE STRICT\nAS '$libdir/btree_gist', $function$gbt_bytea_compress$function$\n",
    "arguments": "internal",
    "return_type": "internal",
    "volatility": "IMMUTABLE",
    "security_definer": false,
    "is_strict": true,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "gbt_bytea_consistent",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.gbt_bytea_consistent(internal, bytea, smallint, oid, internal)\n RETURNS boolean\n LANGUAGE c\n IMMUTABLE PARALLEL SAFE STRICT\nAS '$libdir/btree_gist', $function$gbt_bytea_consistent$function$\n",
    "arguments": "internal, bytea, smallint, oid, internal",
    "return_type": "bool",
    "volatility": "IMMUTABLE",
    "security_definer": false,
    "is_strict": true,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "gbt_bytea_penalty",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.gbt_bytea_penalty(internal, internal, internal)\n RETURNS internal\n LANGUAGE c\n IMMUTABLE PARALLEL SAFE STRICT\nAS '$libdir/btree_gist', $function$gbt_bytea_penalty$function$\n",
    "arguments": "internal, internal, internal",
    "return_type": "internal",
    "volatility": "IMMUTABLE",
    "security_definer": false,
    "is_strict": true,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "gbt_bytea_picksplit",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.gbt_bytea_picksplit(internal, internal)\n RETURNS internal\n LANGUAGE c\n IMMUTABLE PARALLEL SAFE STRICT\nAS '$libdir/btree_gist', $function$gbt_bytea_picksplit$function$\n",
    "arguments": "internal, internal",
    "return_type": "internal",
    "volatility": "IMMUTABLE",
    "security_definer": false,
    "is_strict": true,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "gbt_bytea_same",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.gbt_bytea_same(gbtreekey_var, gbtreekey_var, internal)\n RETURNS internal\n LANGUAGE c\n IMMUTABLE PARALLEL SAFE STRICT\nAS '$libdir/btree_gist', $function$gbt_bytea_same$function$\n",
    "arguments": "gbtreekey_var, gbtreekey_var, internal",
    "return_type": "internal",
    "volatility": "IMMUTABLE",
    "security_definer": false,
    "is_strict": true,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "gbt_bytea_union",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.gbt_bytea_union(internal, internal)\n RETURNS gbtreekey_var\n LANGUAGE c\n IMMUTABLE PARALLEL SAFE STRICT\nAS '$libdir/btree_gist', $function$gbt_bytea_union$function$\n",
    "arguments": "internal, internal",
    "return_type": "gbtreekey_var",
    "volatility": "IMMUTABLE",
    "security_definer": false,
    "is_strict": true,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "gbt_cash_compress",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.gbt_cash_compress(internal)\n RETURNS internal\n LANGUAGE c\n IMMUTABLE PARALLEL SAFE STRICT\nAS '$libdir/btree_gist', $function$gbt_cash_compress$function$\n",
    "arguments": "internal",
    "return_type": "internal",
    "volatility": "IMMUTABLE",
    "security_definer": false,
    "is_strict": true,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "gbt_cash_consistent",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.gbt_cash_consistent(internal, money, smallint, oid, internal)\n RETURNS boolean\n LANGUAGE c\n IMMUTABLE PARALLEL SAFE STRICT\nAS '$libdir/btree_gist', $function$gbt_cash_consistent$function$\n",
    "arguments": "internal, money, smallint, oid, internal",
    "return_type": "bool",
    "volatility": "IMMUTABLE",
    "security_definer": false,
    "is_strict": true,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "gbt_cash_distance",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.gbt_cash_distance(internal, money, smallint, oid, internal)\n RETURNS double precision\n LANGUAGE c\n IMMUTABLE PARALLEL SAFE STRICT\nAS '$libdir/btree_gist', $function$gbt_cash_distance$function$\n",
    "arguments": "internal, money, smallint, oid, internal",
    "return_type": "float8",
    "volatility": "IMMUTABLE",
    "security_definer": false,
    "is_strict": true,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "gbt_cash_fetch",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.gbt_cash_fetch(internal)\n RETURNS internal\n LANGUAGE c\n IMMUTABLE PARALLEL SAFE STRICT\nAS '$libdir/btree_gist', $function$gbt_cash_fetch$function$\n",
    "arguments": "internal",
    "return_type": "internal",
    "volatility": "IMMUTABLE",
    "security_definer": false,
    "is_strict": true,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "gbt_cash_penalty",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.gbt_cash_penalty(internal, internal, internal)\n RETURNS internal\n LANGUAGE c\n IMMUTABLE PARALLEL SAFE STRICT\nAS '$libdir/btree_gist', $function$gbt_cash_penalty$function$\n",
    "arguments": "internal, internal, internal",
    "return_type": "internal",
    "volatility": "IMMUTABLE",
    "security_definer": false,
    "is_strict": true,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "gbt_cash_picksplit",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.gbt_cash_picksplit(internal, internal)\n RETURNS internal\n LANGUAGE c\n IMMUTABLE PARALLEL SAFE STRICT\nAS '$libdir/btree_gist', $function$gbt_cash_picksplit$function$\n",
    "arguments": "internal, internal",
    "return_type": "internal",
    "volatility": "IMMUTABLE",
    "security_definer": false,
    "is_strict": true,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "gbt_cash_same",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.gbt_cash_same(gbtreekey16, gbtreekey16, internal)\n RETURNS internal\n LANGUAGE c\n IMMUTABLE PARALLEL SAFE STRICT\nAS '$libdir/btree_gist', $function$gbt_cash_same$function$\n",
    "arguments": "gbtreekey16, gbtreekey16, internal",
    "return_type": "internal",
    "volatility": "IMMUTABLE",
    "security_definer": false,
    "is_strict": true,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "gbt_cash_union",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.gbt_cash_union(internal, internal)\n RETURNS gbtreekey16\n LANGUAGE c\n IMMUTABLE PARALLEL SAFE STRICT\nAS '$libdir/btree_gist', $function$gbt_cash_union$function$\n",
    "arguments": "internal, internal",
    "return_type": "gbtreekey16",
    "volatility": "IMMUTABLE",
    "security_definer": false,
    "is_strict": true,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "gbt_date_compress",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.gbt_date_compress(internal)\n RETURNS internal\n LANGUAGE c\n IMMUTABLE PARALLEL SAFE STRICT\nAS '$libdir/btree_gist', $function$gbt_date_compress$function$\n",
    "arguments": "internal",
    "return_type": "internal",
    "volatility": "IMMUTABLE",
    "security_definer": false,
    "is_strict": true,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "gbt_date_consistent",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.gbt_date_consistent(internal, date, smallint, oid, internal)\n RETURNS boolean\n LANGUAGE c\n IMMUTABLE PARALLEL SAFE STRICT\nAS '$libdir/btree_gist', $function$gbt_date_consistent$function$\n",
    "arguments": "internal, date, smallint, oid, internal",
    "return_type": "bool",
    "volatility": "IMMUTABLE",
    "security_definer": false,
    "is_strict": true,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "gbt_date_distance",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.gbt_date_distance(internal, date, smallint, oid, internal)\n RETURNS double precision\n LANGUAGE c\n IMMUTABLE PARALLEL SAFE STRICT\nAS '$libdir/btree_gist', $function$gbt_date_distance$function$\n",
    "arguments": "internal, date, smallint, oid, internal",
    "return_type": "float8",
    "volatility": "IMMUTABLE",
    "security_definer": false,
    "is_strict": true,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "gbt_date_fetch",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.gbt_date_fetch(internal)\n RETURNS internal\n LANGUAGE c\n IMMUTABLE PARALLEL SAFE STRICT\nAS '$libdir/btree_gist', $function$gbt_date_fetch$function$\n",
    "arguments": "internal",
    "return_type": "internal",
    "volatility": "IMMUTABLE",
    "security_definer": false,
    "is_strict": true,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "gbt_date_penalty",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.gbt_date_penalty(internal, internal, internal)\n RETURNS internal\n LANGUAGE c\n IMMUTABLE PARALLEL SAFE STRICT\nAS '$libdir/btree_gist', $function$gbt_date_penalty$function$\n",
    "arguments": "internal, internal, internal",
    "return_type": "internal",
    "volatility": "IMMUTABLE",
    "security_definer": false,
    "is_strict": true,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "gbt_date_picksplit",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.gbt_date_picksplit(internal, internal)\n RETURNS internal\n LANGUAGE c\n IMMUTABLE PARALLEL SAFE STRICT\nAS '$libdir/btree_gist', $function$gbt_date_picksplit$function$\n",
    "arguments": "internal, internal",
    "return_type": "internal",
    "volatility": "IMMUTABLE",
    "security_definer": false,
    "is_strict": true,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "gbt_date_same",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.gbt_date_same(gbtreekey8, gbtreekey8, internal)\n RETURNS internal\n LANGUAGE c\n IMMUTABLE PARALLEL SAFE STRICT\nAS '$libdir/btree_gist', $function$gbt_date_same$function$\n",
    "arguments": "gbtreekey8, gbtreekey8, internal",
    "return_type": "internal",
    "volatility": "IMMUTABLE",
    "security_definer": false,
    "is_strict": true,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "gbt_date_union",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.gbt_date_union(internal, internal)\n RETURNS gbtreekey8\n LANGUAGE c\n IMMUTABLE PARALLEL SAFE STRICT\nAS '$libdir/btree_gist', $function$gbt_date_union$function$\n",
    "arguments": "internal, internal",
    "return_type": "gbtreekey8",
    "volatility": "IMMUTABLE",
    "security_definer": false,
    "is_strict": true,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "gbt_decompress",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.gbt_decompress(internal)\n RETURNS internal\n LANGUAGE c\n IMMUTABLE PARALLEL SAFE STRICT\nAS '$libdir/btree_gist', $function$gbt_decompress$function$\n",
    "arguments": "internal",
    "return_type": "internal",
    "volatility": "IMMUTABLE",
    "security_definer": false,
    "is_strict": true,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "gbt_enum_compress",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.gbt_enum_compress(internal)\n RETURNS internal\n LANGUAGE c\n IMMUTABLE PARALLEL SAFE STRICT\nAS '$libdir/btree_gist', $function$gbt_enum_compress$function$\n",
    "arguments": "internal",
    "return_type": "internal",
    "volatility": "IMMUTABLE",
    "security_definer": false,
    "is_strict": true,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "gbt_enum_consistent",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.gbt_enum_consistent(internal, anyenum, smallint, oid, internal)\n RETURNS boolean\n LANGUAGE c\n IMMUTABLE PARALLEL SAFE STRICT\nAS '$libdir/btree_gist', $function$gbt_enum_consistent$function$\n",
    "arguments": "internal, anyenum, smallint, oid, internal",
    "return_type": "bool",
    "volatility": "IMMUTABLE",
    "security_definer": false,
    "is_strict": true,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "gbt_enum_fetch",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.gbt_enum_fetch(internal)\n RETURNS internal\n LANGUAGE c\n IMMUTABLE PARALLEL SAFE STRICT\nAS '$libdir/btree_gist', $function$gbt_enum_fetch$function$\n",
    "arguments": "internal",
    "return_type": "internal",
    "volatility": "IMMUTABLE",
    "security_definer": false,
    "is_strict": true,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "gbt_enum_penalty",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.gbt_enum_penalty(internal, internal, internal)\n RETURNS internal\n LANGUAGE c\n IMMUTABLE PARALLEL SAFE STRICT\nAS '$libdir/btree_gist', $function$gbt_enum_penalty$function$\n",
    "arguments": "internal, internal, internal",
    "return_type": "internal",
    "volatility": "IMMUTABLE",
    "security_definer": false,
    "is_strict": true,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "gbt_enum_picksplit",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.gbt_enum_picksplit(internal, internal)\n RETURNS internal\n LANGUAGE c\n IMMUTABLE PARALLEL SAFE STRICT\nAS '$libdir/btree_gist', $function$gbt_enum_picksplit$function$\n",
    "arguments": "internal, internal",
    "return_type": "internal",
    "volatility": "IMMUTABLE",
    "security_definer": false,
    "is_strict": true,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "gbt_enum_same",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.gbt_enum_same(gbtreekey8, gbtreekey8, internal)\n RETURNS internal\n LANGUAGE c\n IMMUTABLE PARALLEL SAFE STRICT\nAS '$libdir/btree_gist', $function$gbt_enum_same$function$\n",
    "arguments": "gbtreekey8, gbtreekey8, internal",
    "return_type": "internal",
    "volatility": "IMMUTABLE",
    "security_definer": false,
    "is_strict": true,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "gbt_enum_union",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.gbt_enum_union(internal, internal)\n RETURNS gbtreekey8\n LANGUAGE c\n IMMUTABLE PARALLEL SAFE STRICT\nAS '$libdir/btree_gist', $function$gbt_enum_union$function$\n",
    "arguments": "internal, internal",
    "return_type": "gbtreekey8",
    "volatility": "IMMUTABLE",
    "security_definer": false,
    "is_strict": true,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "gbt_float4_compress",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.gbt_float4_compress(internal)\n RETURNS internal\n LANGUAGE c\n IMMUTABLE PARALLEL SAFE STRICT\nAS '$libdir/btree_gist', $function$gbt_float4_compress$function$\n",
    "arguments": "internal",
    "return_type": "internal",
    "volatility": "IMMUTABLE",
    "security_definer": false,
    "is_strict": true,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "gbt_float4_consistent",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.gbt_float4_consistent(internal, real, smallint, oid, internal)\n RETURNS boolean\n LANGUAGE c\n IMMUTABLE PARALLEL SAFE STRICT\nAS '$libdir/btree_gist', $function$gbt_float4_consistent$function$\n",
    "arguments": "internal, real, smallint, oid, internal",
    "return_type": "bool",
    "volatility": "IMMUTABLE",
    "security_definer": false,
    "is_strict": true,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "gbt_float4_distance",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.gbt_float4_distance(internal, real, smallint, oid, internal)\n RETURNS double precision\n LANGUAGE c\n IMMUTABLE PARALLEL SAFE STRICT\nAS '$libdir/btree_gist', $function$gbt_float4_distance$function$\n",
    "arguments": "internal, real, smallint, oid, internal",
    "return_type": "float8",
    "volatility": "IMMUTABLE",
    "security_definer": false,
    "is_strict": true,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "gbt_float4_fetch",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.gbt_float4_fetch(internal)\n RETURNS internal\n LANGUAGE c\n IMMUTABLE PARALLEL SAFE STRICT\nAS '$libdir/btree_gist', $function$gbt_float4_fetch$function$\n",
    "arguments": "internal",
    "return_type": "internal",
    "volatility": "IMMUTABLE",
    "security_definer": false,
    "is_strict": true,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "gbt_float4_penalty",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.gbt_float4_penalty(internal, internal, internal)\n RETURNS internal\n LANGUAGE c\n IMMUTABLE PARALLEL SAFE STRICT\nAS '$libdir/btree_gist', $function$gbt_float4_penalty$function$\n",
    "arguments": "internal, internal, internal",
    "return_type": "internal",
    "volatility": "IMMUTABLE",
    "security_definer": false,
    "is_strict": true,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "gbt_float4_picksplit",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.gbt_float4_picksplit(internal, internal)\n RETURNS internal\n LANGUAGE c\n IMMUTABLE PARALLEL SAFE STRICT\nAS '$libdir/btree_gist', $function$gbt_float4_picksplit$function$\n",
    "arguments": "internal, internal",
    "return_type": "internal",
    "volatility": "IMMUTABLE",
    "security_definer": false,
    "is_strict": true,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "gbt_float4_same",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.gbt_float4_same(gbtreekey8, gbtreekey8, internal)\n RETURNS internal\n LANGUAGE c\n IMMUTABLE PARALLEL SAFE STRICT\nAS '$libdir/btree_gist', $function$gbt_float4_same$function$\n",
    "arguments": "gbtreekey8, gbtreekey8, internal",
    "return_type": "internal",
    "volatility": "IMMUTABLE",
    "security_definer": false,
    "is_strict": true,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "gbt_float4_union",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.gbt_float4_union(internal, internal)\n RETURNS gbtreekey8\n LANGUAGE c\n IMMUTABLE PARALLEL SAFE STRICT\nAS '$libdir/btree_gist', $function$gbt_float4_union$function$\n",
    "arguments": "internal, internal",
    "return_type": "gbtreekey8",
    "volatility": "IMMUTABLE",
    "security_definer": false,
    "is_strict": true,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "gbt_float8_compress",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.gbt_float8_compress(internal)\n RETURNS internal\n LANGUAGE c\n IMMUTABLE PARALLEL SAFE STRICT\nAS '$libdir/btree_gist', $function$gbt_float8_compress$function$\n",
    "arguments": "internal",
    "return_type": "internal",
    "volatility": "IMMUTABLE",
    "security_definer": false,
    "is_strict": true,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "gbt_float8_consistent",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.gbt_float8_consistent(internal, double precision, smallint, oid, internal)\n RETURNS boolean\n LANGUAGE c\n IMMUTABLE PARALLEL SAFE STRICT\nAS '$libdir/btree_gist', $function$gbt_float8_consistent$function$\n",
    "arguments": "internal, double precision, smallint, oid, internal",
    "return_type": "bool",
    "volatility": "IMMUTABLE",
    "security_definer": false,
    "is_strict": true,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "gbt_float8_distance",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.gbt_float8_distance(internal, double precision, smallint, oid, internal)\n RETURNS double precision\n LANGUAGE c\n IMMUTABLE PARALLEL SAFE STRICT\nAS '$libdir/btree_gist', $function$gbt_float8_distance$function$\n",
    "arguments": "internal, double precision, smallint, oid, internal",
    "return_type": "float8",
    "volatility": "IMMUTABLE",
    "security_definer": false,
    "is_strict": true,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "gbt_float8_fetch",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.gbt_float8_fetch(internal)\n RETURNS internal\n LANGUAGE c\n IMMUTABLE PARALLEL SAFE STRICT\nAS '$libdir/btree_gist', $function$gbt_float8_fetch$function$\n",
    "arguments": "internal",
    "return_type": "internal",
    "volatility": "IMMUTABLE",
    "security_definer": false,
    "is_strict": true,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "gbt_float8_penalty",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.gbt_float8_penalty(internal, internal, internal)\n RETURNS internal\n LANGUAGE c\n IMMUTABLE PARALLEL SAFE STRICT\nAS '$libdir/btree_gist', $function$gbt_float8_penalty$function$\n",
    "arguments": "internal, internal, internal",
    "return_type": "internal",
    "volatility": "IMMUTABLE",
    "security_definer": false,
    "is_strict": true,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "gbt_float8_picksplit",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.gbt_float8_picksplit(internal, internal)\n RETURNS internal\n LANGUAGE c\n IMMUTABLE PARALLEL SAFE STRICT\nAS '$libdir/btree_gist', $function$gbt_float8_picksplit$function$\n",
    "arguments": "internal, internal",
    "return_type": "internal",
    "volatility": "IMMUTABLE",
    "security_definer": false,
    "is_strict": true,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "gbt_float8_same",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.gbt_float8_same(gbtreekey16, gbtreekey16, internal)\n RETURNS internal\n LANGUAGE c\n IMMUTABLE PARALLEL SAFE STRICT\nAS '$libdir/btree_gist', $function$gbt_float8_same$function$\n",
    "arguments": "gbtreekey16, gbtreekey16, internal",
    "return_type": "internal",
    "volatility": "IMMUTABLE",
    "security_definer": false,
    "is_strict": true,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "gbt_float8_union",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.gbt_float8_union(internal, internal)\n RETURNS gbtreekey16\n LANGUAGE c\n IMMUTABLE PARALLEL SAFE STRICT\nAS '$libdir/btree_gist', $function$gbt_float8_union$function$\n",
    "arguments": "internal, internal",
    "return_type": "gbtreekey16",
    "volatility": "IMMUTABLE",
    "security_definer": false,
    "is_strict": true,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "gbt_inet_compress",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.gbt_inet_compress(internal)\n RETURNS internal\n LANGUAGE c\n IMMUTABLE PARALLEL SAFE STRICT\nAS '$libdir/btree_gist', $function$gbt_inet_compress$function$\n",
    "arguments": "internal",
    "return_type": "internal",
    "volatility": "IMMUTABLE",
    "security_definer": false,
    "is_strict": true,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "gbt_inet_consistent",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.gbt_inet_consistent(internal, inet, smallint, oid, internal)\n RETURNS boolean\n LANGUAGE c\n IMMUTABLE PARALLEL SAFE STRICT\nAS '$libdir/btree_gist', $function$gbt_inet_consistent$function$\n",
    "arguments": "internal, inet, smallint, oid, internal",
    "return_type": "bool",
    "volatility": "IMMUTABLE",
    "security_definer": false,
    "is_strict": true,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "gbt_inet_penalty",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.gbt_inet_penalty(internal, internal, internal)\n RETURNS internal\n LANGUAGE c\n IMMUTABLE PARALLEL SAFE STRICT\nAS '$libdir/btree_gist', $function$gbt_inet_penalty$function$\n",
    "arguments": "internal, internal, internal",
    "return_type": "internal",
    "volatility": "IMMUTABLE",
    "security_definer": false,
    "is_strict": true,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "gbt_inet_picksplit",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.gbt_inet_picksplit(internal, internal)\n RETURNS internal\n LANGUAGE c\n IMMUTABLE PARALLEL SAFE STRICT\nAS '$libdir/btree_gist', $function$gbt_inet_picksplit$function$\n",
    "arguments": "internal, internal",
    "return_type": "internal",
    "volatility": "IMMUTABLE",
    "security_definer": false,
    "is_strict": true,
    "returns_set": false,
    "is_leakproof": false
  },
  {
    "function_name": "gbt_inet_same",
    "schema_name": "public",
    "function_definition": "CREATE OR REPLACE FUNCTION public.gbt_inet_same(gbtreekey16, gbtreekey16, internal)\n RETURNS internal\n LANGUAGE c\n IMMUTABLE PARALLEL SAFE STRICT\nAS '$libdir/btree_gist', $function$gbt_inet_same$function$\n",
    "arguments": "gbtreekey16, gbtreekey16, internal",
    "return_type": "internal",
    "volatility": "IMMUTABLE",
    "security_definer": false,
    "is_strict": true,
    "returns_set": false,
    "is_leakproof": false
  }
]
TRIGGERS
[
  {
    "trigger_name": "trg_matches_apply_result",
    "event_manipulation": "INSERT",
    "table_name": "matches",
    "action_statement": "EXECUTE FUNCTION trg_matches_apply_result()"
  },
  {
    "trigger_name": "trg_admins_email_lower",
    "event_manipulation": "INSERT",
    "table_name": "admins",
    "action_statement": "EXECUTE FUNCTION _admins_email_lowercase()"
  },
  {
    "trigger_name": "trg_admins_email_lower",
    "event_manipulation": "UPDATE",
    "table_name": "admins",
    "action_statement": "EXECUTE FUNCTION _admins_email_lowercase()"
  },
  {
    "trigger_name": "trg_app_settings_u",
    "event_manipulation": "UPDATE",
    "table_name": "app_settings",
    "action_statement": "EXECUTE FUNCTION _app_settings_set_updated_at()"
  },
  {
    "trigger_name": "trg_guard_waiting_list",
    "event_manipulation": "INSERT",
    "table_name": "waiting_list",
    "action_statement": "EXECUTE FUNCTION guard_unique_membership()"
  },
  {
    "trigger_name": "trg_guard_waiting_list",
    "event_manipulation": "UPDATE",
    "table_name": "waiting_list",
    "action_statement": "EXECUTE FUNCTION guard_unique_membership()"
  },
  {
    "trigger_name": "trg_guard_ranking",
    "event_manipulation": "INSERT",
    "table_name": "ranking_positions",
    "action_statement": "EXECUTE FUNCTION guard_unique_membership()"
  },
  {
    "trigger_name": "trg_guard_ranking",
    "event_manipulation": "UPDATE",
    "table_name": "ranking_positions",
    "action_statement": "EXECUTE FUNCTION guard_unique_membership()"
  },
  {
    "trigger_name": "trg_challenges_accept",
    "event_manipulation": "UPDATE",
    "table_name": "challenges",
    "action_statement": "EXECUTE FUNCTION trg_challenges_accept()"
  },
  {
    "trigger_name": "trg_challenges_validate",
    "event_manipulation": "INSERT",
    "table_name": "challenges",
    "action_statement": "EXECUTE FUNCTION trg_challenges_validate()"
  },
  {
    "trigger_name": "trg_enforce_max_rank_gap",
    "event_manipulation": "INSERT",
    "table_name": "challenges",
    "action_statement": "EXECUTE FUNCTION enforce_max_rank_gap()"
  },
  {
    "trigger_name": "trg_enforce_max_rank_gap",
    "event_manipulation": "UPDATE",
    "table_name": "challenges",
    "action_statement": "EXECUTE FUNCTION enforce_max_rank_gap()"
  },
  {
    "trigger_name": "trg_challenges_set_positions",
    "event_manipulation": "INSERT",
    "table_name": "challenges",
    "action_statement": "EXECUTE FUNCTION fn_challenges_set_positions()"
  },
  {
    "trigger_name": "trg_matches_finalize",
    "event_manipulation": "INSERT",
    "table_name": "matches",
    "action_statement": "EXECUTE FUNCTION fn_matches_finalize()"
  },
  {
    "trigger_name": "inc_reprogramacions",
    "event_manipulation": "UPDATE",
    "table_name": "challenges",
    "action_statement": "EXECUTE FUNCTION trg_inc_reprogramacions()"
  }
]
